<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>University Admissions Dashboard</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
        }
        
        .dashboard-header {
            background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
            color: white;
            padding: 2rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .dashboard-header h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            font-weight: 700;
        }
        
        .dashboard-header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }
        
        .current-date-notice {
            background: #f39c12;
            color: white;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1.5rem;
            text-align: center;
            font-weight: 600;
        }
        
        .cycle-progress {
            background: white;
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            margin-bottom: 2rem;
        }
        
        .progress-bar-container {
            background: #ecf0f1;
            height: 30px;
            border-radius: 15px;
            overflow: hidden;
            position: relative;
            margin: 1rem 0;
        }
        
        .progress-bar {
            background: linear-gradient(90deg, #3498db 0%, #2980b9 100%);
            height: 100%;
            border-radius: 15px;
            transition: width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
        }
        
        .cycle-info {
            display: flex;
            justify-content: space-between;
            margin-top: 0.5rem;
            font-size: 0.9rem;
            color: #666;
        }
        
        .filters-section {
            background: white;
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            margin-bottom: 2rem;
        }
        
        .filter-group {
            display: flex;
            gap: 1rem;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .filter-group label {
            font-weight: 600;
            color: #555;
        }
        
        .filter-group select {
            padding: 0.5rem 1rem;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
            background: white;
            cursor: pointer;
            transition: border-color 0.3s;
        }
        
        .filter-group select:hover {
            border-color: #3498db;
        }
        
        .filter-group select:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .stat-card {
            background: white;
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            transition: transform 0.3s, box-shadow 0.3s;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }
        
        .stat-card.primary {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            color: white;
        }
        
        .stat-card.success {
            background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);
            color: white;
        }
        
        .stat-card.warning {
            background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
            color: white;
        }
        
        .stat-card.danger {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            color: white;
        }
        
        .stat-card h3 {
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            opacity: 0.9;
        }
        
        .stat-card .value {
            font-size: 2.2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }
        
        .stat-card .change {
            font-size: 0.85rem;
            opacity: 0.8;
        }
        
        .stat-card .note {
            font-size: 0.75rem;
            opacity: 0.7;
            margin-top: 0.5rem;
        }
        
        .chart-section {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            margin-bottom: 2rem;
        }
        
        .chart-section h2 {
            font-size: 1.5rem;
            margin-bottom: 1.5rem;
            color: #2c3e50;
        }
        
        .chart-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 2rem;
        }
        
        .chart-container {
            position: relative;
            height: 400px;
        }
        
        .campus-comparison {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            overflow-x: auto;
        }
        
        .campus-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
            table-layout: auto;
        }
        
        .campus-table th {
            background: #f8f9fa;
            padding: 1rem;
            text-align: left;
            font-weight: 600;
            border-bottom: 2px solid #dee2e6;
            white-space: nowrap;
        }
        
        .campus-table td {
            padding: 0.75rem 1rem;
            border-bottom: 1px solid #dee2e6;
        }
        
        .campus-table tr:hover {
            background: #f8f9fa;
        }
        
        .stat-card .trend-up {
            color: #ffffff;
            font-weight: 600;
        }
        
        .stat-card .trend-down {
            color: #ffffff;
            font-weight: 600;
        }
        
        .trend-up {
            color: #27ae60;
        }
        
        .trend-down {
            color: #e74c3c;
        }
        
        .campus-table th:last-child {
            background: #e8f4f8;
            font-weight: 700;
        }
        
        .campus-table td:last-child {
            background: #f8fcfd;
            font-weight: 600;
        }
        
        @media (max-width: 768px) {
            .dashboard-header h1 {
                font-size: 1.8rem;
            }
            
            .chart-grid {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .campus-table {
                font-size: 0.9rem;
            }
            
            .campus-table td, .campus-table th {
                padding: 0.5rem;
            }
        }
    </style>
</head>
<body>
    <div class="dashboard-header">
        <div class="container">
            <h1>University Admissions Dashboard</h1>
            <p>Real-time tracking of admissions data across all campuses</p>
        </div>
    </div>
    
    <div class="container">
        <div class="current-date-notice">
            ðŸ“… Data current as of July 17, 2025 - Day 33 of 139 (23.7% through admission cycle)
        </div>
        
        <div class="cycle-progress">
            <h3 style="margin-bottom: 1rem;">Admission Cycle Progress</h3>
            <div class="progress-bar-container">
                <div class="progress-bar" style="width: 23.7%;">
                    Day 33
                </div>
            </div>
            <div class="cycle-info">
                <span>Start: June 15</span>
                <span>Current: July 17 (Day 33)</span>
                <span>End: October 31 (Day 139)</span>
            </div>
        </div>
        
        <div class="filters-section">
            <div class="filter-group">
                <label for="campusFilter">Campus:</label>
                <select id="campusFilter">
                    <option value="all">All Campuses Combined</option>
                    <option value="Akkar">Akkar</option>
                    <option value="Beirut">Beirut</option>
                    <option value="Mount Lebanon">Mount Lebanon</option>
                    <option value="Nabatieh">Nabatieh</option>
                    <option value="Saida">Saida</option>
                    <option value="Tripoli">Tripoli</option>
                    <option value="Tyre">Tyre</option>
                </select>
                
                <label for="yearFilter">Year:</label>
                <select id="yearFilter">
                    <option value="2025">Fall 2025-2026 (Current)</option>
                    <option value="2024">Fall 2024-2025</option>
                    <option value="2023">Fall 2023-2024</option>
                    <option value="2019">Fall 2019-2020</option>
                    <option value="compare">Compare All Years</option>
                </select>
                
                <label for="dateFilter">View Data As Of:</label>
                <select id="dateFilter">
                    <option value="current">July 17 (Comparable)</option>
                    <option value="full">Full Year (Oct 31)</option>
                </select>
            </div>
        </div>
        
        <div class="stats-grid">
            <div class="stat-card primary">
                <h3>Total Applicants</h3>
                <div class="value" id="totalApplicants">442</div>
                <div class="change" id="applicantsChange"></div>
                <div class="note" id="applicantsNote"></div>
            </div>
            
            <div class="stat-card success">
                <h3>Total Registered</h3>
                <div class="value" id="totalRegistered">4</div>
                <div class="change" id="registeredChange"></div>
                <div class="note" id="registeredNote"></div>
            </div>
            
            <div class="stat-card warning">
                <h3>Registration Rate</h3>
                <div class="value" id="registrationRate">0.9%</div>
                <div class="change" id="rateChange"></div>
                <div class="note" id="rateNote"></div>
            </div>
            
            <div class="stat-card danger">
                <h3>Today's Applications</h3>
                <div class="value" id="todayApplicants">38</div>
                <div class="change" id="todayChange"></div>
                <div class="note" id="todayNote">July 17 Daily Total</div>
            </div>
        </div>
        
        <div class="chart-section" style="background: linear-gradient(135deg, #f5f7fa 0%, #e8f4f8 100%); border: 2px solid #3498db;">
            <h2 style="color: #2c3e50;">ðŸ“Š Daily Performance Analysis - Day 33 (July 17)</h2>
            <p style="color: #666; margin-bottom: 1.5rem;">Comparing today's performance against the same day in previous admission cycles</p>
            
            <div class="stats-grid" style="margin-bottom: 1.5rem;">
                <div class="stat-card" style="background: white;">
                    <h3>Today vs 2024</h3>
                    <div class="value" id="todayVs2024">+660.0%</div>
                    <div class="change" id="todayVs2024Change"></div>
                    <div class="note">38 vs 5 applications</div>
                </div>
                
                <div class="stat-card" style="background: white;">
                    <h3>Today vs 2023</h3>
                    <div class="value" id="todayVs2023">-54.8%</div>
                    <div class="change" id="todayVs2023Change"></div>
                    <div class="note">38 vs 84 applications</div>
                </div>
                
                <div class="stat-card" style="background: white;">
                    <h3>Today vs 2019</h3>
                    <div class="value" id="todayVs2019">-44.1%</div>
                    <div class="change" id="todayVs2019Change"></div>
                    <div class="note">38 vs 68 applications</div>
                </div>
                
                <div class="stat-card" style="background: white;">
                    <h3>Performance Index</h3>
                    <div class="value" id="performanceIndex">72.6%</div>
                    <div class="change" id="performanceIndexChange"></div>
                    <div class="note">vs 3-year average</div>
                </div>
            </div>
            
            <div class="chart-grid">
                <div class="chart-container">
                    <canvas id="cumulativeComparisonChart"></canvas>
                </div>
                <div class="chart-container">
                    <canvas id="dailyPerformanceChart"></canvas>
                </div>
            </div>
            
            <div class="chart-grid" style="margin-top: 1.5rem;">
                <div class="chart-container">
                    <canvas id="projectionChart"></canvas>
                </div>
                <div class="chart-container">
                    <canvas id="campusPerformanceHeatmap"></canvas>
                </div>
            </div>
        </div>
        
        <div class="chart-section">
            <h2>Admissions Trends</h2>
            <div class="chart-grid">
                <div class="chart-container">
                    <canvas id="applicantsChart"></canvas>
                </div>
                <div class="chart-container">
                    <canvas id="registrationChart"></canvas>
                </div>
            </div>
        </div>
        
        <div class="chart-section">
            <h2>Campus Performance</h2>
            <div class="chart-container" style="height: 300px;">
                <canvas id="campusComparisonChart"></canvas>
            </div>
        </div>
        
        <div class="chart-section">
            <h2>Daily Applications Comparison (July 17)</h2>
            <div class="chart-grid">
                <div class="chart-container" style="height: 300px;">
                    <canvas id="dailyComparisonChart"></canvas>
                </div>
                <div class="chart-container" style="height: 300px;">
                    <canvas id="dailyCampusChart"></canvas>
                </div>
            </div>
        </div>
        
        <div class="chart-section">
            <h2>Weekly Pattern Analysis</h2>
            <p style="color: #666; margin-bottom: 1rem;">Application volumes by day of the week to identify peak application days</p>
            <div class="chart-grid">
                <div class="chart-container">
                    <canvas id="weeklyPatternChart"></canvas>
                </div>
                <div class="chart-container">
                    <canvas id="weeklyHeatmapChart"></canvas>
                </div>
            </div>
        </div>
        
        <div class="campus-comparison">
            <h2>Campus Details (As of July 17 - Day 33)</h2>
            <table class="campus-table" id="campusTable">
                <thead>
                    <tr>
                        <th>Campus</th>
                        <th>Applicants</th>
                        <th>Registered</th>
                        <th>Registration Rate</th>
                        <th>vs Last Year</th>
                        <th>vs Pre-COVID (2019)</th>
                    </tr>
                </thead>
                <tbody id="campusTableBody">
                </tbody>
            </table>
        </div>
    </div>
    
    <script>
        // Admission cycle information
        const cycleInfo = {
            startDate: 'June 15',
            endDate: 'October 31',
            totalDays: 139,
            currentDay: 33,
            currentDate: 'July 17'
        };
        
        // Updated data from CSV - Day 33 comparable data (July 17)
        const july17Data = {
            "Akkar": {
                "2019": {
                    "accApplicants": 6,
                    "accRegistered": 3,
                    "dailyApplicants": 0
                },
                "2023": {
                    "accApplicants": 7,
                    "accRegistered": 0,
                    "dailyApplicants": 1
                },
                "2024": {
                    "accApplicants": 6,
                    "accRegistered": 3,
                    "dailyApplicants": 0
                },
                "2025": {
                    "accApplicants": 8,
                    "accRegistered": 2,
                    "dailyApplicants": 1
                }
            },
            "Beirut": {
                "2019": {
                    "accApplicants": 862,
                    "accRegistered": 482,
                    "dailyApplicants": 54
                },
                "2023": {
                    "accApplicants": 515,
                    "accRegistered": 305,
                    "dailyApplicants": 58
                },
                "2024": {
                    "accApplicants": 378,
                    "accRegistered": 270,
                    "dailyApplicants": 2
                },
                "2025": {
                    "accApplicants": 304,
                    "accRegistered": 2,
                    "dailyApplicants": 28
                }
            },
            "Mount Lebanon": {
                "2019": {
                    "accApplicants": 67,
                    "accRegistered": 37,
                    "dailyApplicants": 8
                },
                "2023": {
                    "accApplicants": 73,
                    "accRegistered": 51,
                    "dailyApplicants": 4
                },
                "2024": {
                    "accApplicants": 47,
                    "accRegistered": 41,
                    "dailyApplicants": 0
                },
                "2025": {
                    "accApplicants": 28,
                    "accRegistered": 0,
                    "dailyApplicants": 0
                }
            },
            "Nabatieh": {
                "2019": {
                    "accApplicants": 22,
                    "accRegistered": 5,
                    "dailyApplicants": 1
                },
                "2023": {
                    "accApplicants": 55,
                    "accRegistered": 25,
                    "dailyApplicants": 1
                },
                "2024": {
                    "accApplicants": 29,
                    "accRegistered": 13,
                    "dailyApplicants": 0
                },
                "2025": {
                    "accApplicants": 24,
                    "accRegistered": 0,
                    "dailyApplicants": 3
                }
            },
            "Saida": {
                "2019": {
                    "accApplicants": 71,
                    "accRegistered": 4,
                    "dailyApplicants": 1
                },
                "2023": {
                    "accApplicants": 89,
                    "accRegistered": 40,
                    "dailyApplicants": 11
                },
                "2024": {
                    "accApplicants": 62,
                    "accRegistered": 46,
                    "dailyApplicants": 1
                },
                "2025": {
                    "accApplicants": 46,
                    "accRegistered": 0,
                    "dailyApplicants": 6
                }
            },
            "Tripoli": {
                "2019": {
                    "accApplicants": 44,
                    "accRegistered": 0,
                    "dailyApplicants": 2
                },
                "2023": {
                    "accApplicants": 95,
                    "accRegistered": 17,
                    "dailyApplicants": 4
                },
                "2024": {
                    "accApplicants": 34,
                    "accRegistered": 16,
                    "dailyApplicants": 2
                },
                "2025": {
                    "accApplicants": 12,
                    "accRegistered": 0,
                    "dailyApplicants": 0
                }
            },
            "Tyre": {
                "2019": {
                    "accApplicants": 12,
                    "accRegistered": 2,
                    "dailyApplicants": 2
                },
                "2023": {
                    "accApplicants": 48,
                    "accRegistered": 26,
                    "dailyApplicants": 5
                },
                "2024": {
                    "accApplicants": 21,
                    "accRegistered": 7,
                    "dailyApplicants": 0
                },
                "2025": {
                    "accApplicants": 20,
                    "accRegistered": 0,
                    "dailyApplicants": 0
                }
            }
        };
        
        // Updated full year data (Oct 31 for complete years, current for 2025)
        const fullYearData = {
            "Akkar": {
                "2019": {
                    "accApplicants": 621,
                    "accRegistered": 559,
                    "droppedAll": 0,
                    "hasID": 0
                },
                "2023": {
                    "accApplicants": 443,
                    "accRegistered": 325,
                    "droppedAll": 0,
                    "hasID": 0
                },
                "2024": {
                    "accApplicants": 383,
                    "accRegistered": 317,
                    "droppedAll": 0,
                    "hasID": 2
                },
                "2025": {
                    "accApplicants": 8,
                    "accRegistered": 2,
                    "droppedAll": 0,
                    "hasID": 0
                }
            },
            "Beirut": {
                "2019": {
                    "accApplicants": 4260,
                    "accRegistered": 2947,
                    "droppedAll": 0,
                    "hasID": 0
                },
                "2023": {
                    "accApplicants": 3413,
                    "accRegistered": 2368,
                    "droppedAll": 0,
                    "hasID": 4
                },
                "2024": {
                    "accApplicants": 2740,
                    "accRegistered": 1805,
                    "droppedAll": 0,
                    "hasID": 5
                },
                "2025": {
                    "accApplicants": 304,
                    "accRegistered": 2,
                    "droppedAll": 0,
                    "hasID": 0
                }
            },
            "Mount Lebanon": {
                "2019": {
                    "accApplicants": 493,
                    "accRegistered": 359,
                    "droppedAll": 0,
                    "hasID": 0
                },
                "2023": {
                    "accApplicants": 398,
                    "accRegistered": 294,
                    "droppedAll": 0,
                    "hasID": 0
                },
                "2024": {
                    "accApplicants": 327,
                    "accRegistered": 258,
                    "droppedAll": 0,
                    "hasID": 1
                },
                "2025": {
                    "accApplicants": 28,
                    "accRegistered": 0,
                    "droppedAll": 0,
                    "hasID": 0
                }
            },
            "Nabatieh": {
                "2019": {
                    "accApplicants": 695,
                    "accRegistered": 593,
                    "droppedAll": 0,
                    "hasID": 0
                },
                "2023": {
                    "accApplicants": 841,
                    "accRegistered": 621,
                    "droppedAll": 0,
                    "hasID": 0
                },
                "2024": {
                    "accApplicants": 522,
                    "accRegistered": 338,
                    "droppedAll": 0,
                    "hasID": 0
                },
                "2025": {
                    "accApplicants": 24,
                    "accRegistered": 0,
                    "droppedAll": 0,
                    "hasID": 0
                }
            },
            "Saida": {
                "2019": {
                    "accApplicants": 1287,
                    "accRegistered": 964,
                    "droppedAll": 0,
                    "hasID": 0
                },
                "2023": {
                    "accApplicants": 1165,
                    "accRegistered": 885,
                    "droppedAll": 0,
                    "hasID": 0
                },
                "2024": {
                    "accApplicants": 1003,
                    "accRegistered": 759,
                    "droppedAll": 0,
                    "hasID": 0
                },
                "2025": {
                    "accApplicants": 46,
                    "accRegistered": 0,
                    "droppedAll": 0,
                    "hasID": 0
                }
            },
            "Tripoli": {
                "2019": {
                    "accApplicants": 1279,
                    "accRegistered": 1021,
                    "droppedAll": 0,
                    "hasID": 0
                },
                "2023": {
                    "accApplicants": 1490,
                    "accRegistered": 1003,
                    "droppedAll": 0,
                    "hasID": 0
                },
                "2024": {
                    "accApplicants": 1050,
                    "accRegistered": 762,
                    "droppedAll": 0,
                    "hasID": 1
                },
                "2025": {
                    "accApplicants": 12,
                    "accRegistered": 0,
                    "droppedAll": 0,
                    "hasID": 0
                }
            },
            "Tyre": {
                "2019": {
                    "accApplicants": 965,
                    "accRegistered": 849,
                    "droppedAll": 0,
                    "hasID": 0
                },
                "2023": {
                    "accApplicants": 1028,
                    "accRegistered": 834,
                    "droppedAll": 0,
                    "hasID": 0
                },
                "2024": {
                    "accApplicants": 870,
                    "accRegistered": 605,
                    "droppedAll": 0,
                    "hasID": 1
                },
                "2025": {
                    "accApplicants": 20,
                    "accRegistered": 0,
                    "droppedAll": 0,
                    "hasID": 0
                }
            }
        };
        
        // Chart instances
        let applicantsChart, registrationChart, campusComparisonChart, dailyComparisonChart, dailyCampusChart, weeklyPatternChart, weeklyHeatmapChart;
        let cumulativeComparisonChart, dailyPerformanceChart, projectionChart, campusPerformanceHeatmap;
        let currentDataSet = july17Data; // Default to comparable data
        
        // Initialize charts
        function initCharts() {
            console.log('Initializing charts...');
            
            // Helper function to safely create charts
            function createChart(canvasId, config) {
                try {
                    const element = document.getElementById(canvasId);
                    if (!element) {
                        console.error(`Canvas element '${canvasId}' not found`);
                        return null;
                    }
                    const ctx = element.getContext('2d');
                    return new Chart(ctx, config);
                } catch (error) {
                    console.error(`Error creating chart '${canvasId}':`, error);
                    return null;
                }
            }
            
            const chartOptions = {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: true,
                        position: 'top',
                        labels: {
                            font: {
                                size: 12,
                                weight: '600'
                            },
                            padding: 15,
                            usePointStyle: true
                        }
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        grid: {
                            drawBorder: false,
                            color: 'rgba(0, 0, 0, 0.05)'
                        }
                    },
                    x: {
                        grid: {
                            display: false
                        }
                    }
                }
            };
            
            // Applicants trend chart
            applicantsChart = createChart('applicantsChart', {
                type: 'line',
                data: {
                    labels: [],
                    datasets: []
                },
                options: {
                    ...chartOptions,
                    plugins: {
                        ...chartOptions.plugins,
                        title: {
                            display: true,
                            text: 'Year-over-Year Applicant Comparison',
                            font: {
                                size: 16,
                                weight: '600'
                            }
                        }
                    }
                }
            });
            
            // Registration rate chart
            registrationChart = createChart('registrationChart', {
                type: 'bar',
                data: {
                    labels: [],
                    datasets: []
                },
                options: {
                    ...chartOptions,
                    plugins: {
                        ...chartOptions.plugins,
                        title: {
                            display: true,
                            text: 'Registration Rates by Year',
                            font: {
                                size: 16,
                                weight: '600'
                            }
                        }
                    },
                    scales: {
                        ...chartOptions.scales,
                        y: {
                            ...chartOptions.scales.y,
                            ticks: {
                                callback: function(value) {
                                    return value + '%';
                                }
                            },
                            max: 100
                        }
                    }
                }
            });
            
            // Campus comparison chart
            campusComparisonChart = createChart('campusComparisonChart', {
                type: 'bar',
                data: {
                    labels: [],
                    datasets: []
                },
                options: {
                    ...chartOptions,
                    plugins: {
                        ...chartOptions.plugins,
                        title: {
                            display: true,
                            text: 'Campus Performance (Sorted by Total Applicants)',
                            font: {
                                size: 16,
                                weight: '600'
                            }
                        }
                    }
                }
            });
            
            // Daily comparison chart
            dailyComparisonChart = createChart('dailyComparisonChart', {
                type: 'bar',
                data: {
                    labels: [],
                    datasets: []
                },
                options: {
                    ...chartOptions,
                    plugins: {
                        ...chartOptions.plugins,
                        title: {
                            display: true,
                            text: 'Daily Applications on July 17 (Day 33) - Year Comparison',
                            font: {
                                size: 16,
                                weight: '600'
                            }
                        }
                    }
                }
            });
            
            // Daily campus chart
            dailyCampusChart = createChart('dailyCampusChart', {
                type: 'bar',
                data: {
                    labels: [],
                    datasets: []
                },
                options: {
                    ...chartOptions,
                    indexAxis: 'y',
                    plugins: {
                        ...chartOptions.plugins,
                        title: {
                            display: true,
                            text: 'Daily Applications by Campus - July 17, 2025',
                            font: {
                                size: 16,
                                weight: '600'
                            }
                        }
                    }
                }
            });
            
            // Weekly pattern chart
            weeklyPatternChart = createChart('weeklyPatternChart', {
                type: 'bar',
                data: {
                    labels: [],
                    datasets: []
                },
                options: {
                    ...chartOptions,
                    plugins: {
                        ...chartOptions.plugins,
                        title: {
                            display: true,
                            text: 'Average Daily Applications by Day of Week',
                            font: {
                                size: 16,
                                weight: '600'
                            }
                        }
                    },
                    scales: {
                        ...chartOptions.scales,
                        y: {
                            ...chartOptions.scales.y,
                            title: {
                                display: true,
                                text: 'Average Applications'
                            }
                        }
                    }
                }
            });
            
            // Weekly heatmap chart
            weeklyHeatmapChart = createChart('weeklyHeatmapChart', {
                type: 'bar',
                data: {
                    labels: [],
                    datasets: []
                },
                options: {
                    ...chartOptions,
                    plugins: {
                        ...chartOptions.plugins,
                        title: {
                            display: true,
                            text: 'Peak Application Days by Campus',
                            font: {
                                size: 16,
                                weight: '600'
                            }
                        }
                    },
                    scales: {
                        ...chartOptions.scales,
                        x: {
                            stacked: true,
                            grid: {
                                display: false
                            }
                        },
                        y: {
                            stacked: true,
                            beginAtZero: true
                        }
                    }
                }
            });
            
            // Cumulative comparison chart
            cumulativeComparisonChart = createChart('cumulativeComparisonChart', {
                type: 'line',
                data: {
                    labels: [],
                    datasets: []
                },
                options: {
                    ...chartOptions,
                    plugins: {
                        ...chartOptions.plugins,
                        title: {
                            display: true,
                            text: 'Cumulative Applications - First 33 Days',
                            font: {
                                size: 16,
                                weight: '600'
                            }
                        }
                    },
                    scales: {
                        ...chartOptions.scales,
                        y: {
                            ...chartOptions.scales.y,
                            title: {
                                display: true,
                                text: 'Total Applications'
                            }
                        }
                    }
                }
            });
            
            // Daily performance chart
            dailyPerformanceChart = createChart('dailyPerformanceChart', {
                type: 'bar',
                data: {
                    labels: [],
                    datasets: []
                },
                options: {
                    ...chartOptions,
                    plugins: {
                        ...chartOptions.plugins,
                        title: {
                            display: true,
                            text: 'Day 33 Applications Comparison',
                            font: {
                                size: 16,
                                weight: '600'
                            }
                        }
                    }
                }
            });
            
            // Projection chart
            projectionChart = createChart('projectionChart', {
                type: 'bar',
                data: {
                    labels: [],
                    datasets: []
                },
                options: {
                    ...chartOptions,
                    plugins: {
                        ...chartOptions.plugins,
                        title: {
                            display: true,
                            text: 'Projected End-of-Cycle Totals',
                            font: {
                                size: 16,
                                weight: '600'
                            }
                        }
                    },
                    scales: {
                        ...chartOptions.scales,
                        y: {
                            ...chartOptions.scales.y,
                            title: {
                                display: true,
                                text: 'Projected Total Applications'
                            }
                        }
                    }
                }
            });
            
            // Campus performance heatmap
            campusPerformanceHeatmap = createChart('campusPerformanceHeatmap', {
                type: 'bar',
                data: {
                    labels: [],
                    datasets: []
                },
                options: {
                    ...chartOptions,
                    indexAxis: 'y',
                    plugins: {
                        ...chartOptions.plugins,
                        title: {
                            display: true,
                            text: 'Campus Performance vs Last Year (Day 33)',
                            font: {
                                size: 16,
                                weight: '600'
                            }
                        }
                    },
                    scales: {
                        ...chartOptions.scales,
                        x: {
                            ...chartOptions.scales.x,
                            ticks: {
                                callback: function(value) {
                                    return value + '%';
                                }
                            }
                        }
                    }
                }
            });
        }
        
        // Update dashboard based on filters
        function updateDashboard() {
            const selectedCampus = document.getElementById('campusFilter').value;
            const selectedYear = document.getElementById('yearFilter').value;
            const selectedDateView = document.getElementById('dateFilter').value;
            
            // Update data source based on date view
            currentDataSet = selectedDateView === 'current' ? july17Data : fullYearData;
            
            if (selectedYear === 'compare') {
                showYearComparison(selectedCampus);
            } else {
                showYearData(selectedCampus, selectedYear);
            }
            
            updateCampusTable(selectedYear);
        }
        
        // Show data for a specific year
        function showYearData(campus, year) {
            let totalApplicants = 0;
            let totalRegistered = 0;
            let todayApplicants = 0;
            
            if (campus === 'all') {
                // Aggregate all campuses
                for (const campusName in currentDataSet) {
                    if (currentDataSet[campusName][year]) {
                        totalApplicants += currentDataSet[campusName][year].accApplicants || 0;
                        totalRegistered += currentDataSet[campusName][year].accRegistered || 0;
                        todayApplicants += currentDataSet[campusName][year].dailyApplicants || 0;
                    }
                }
            } else {
                // Single campus
                if (currentDataSet[campus] && currentDataSet[campus][year]) {
                    totalApplicants = currentDataSet[campus][year].accApplicants || 0;
                    totalRegistered = currentDataSet[campus][year].accRegistered || 0;
                    todayApplicants = currentDataSet[campus][year].dailyApplicants || 0;
                }
            }
            
            // Update stat cards
            document.getElementById('totalApplicants').textContent = totalApplicants.toLocaleString();
            document.getElementById('totalRegistered').textContent = totalRegistered.toLocaleString();
            document.getElementById('todayApplicants').textContent = todayApplicants.toLocaleString();
            
            const regRate = totalApplicants > 0 ? ((totalRegistered / totalApplicants) * 100).toFixed(1) : 0;
            document.getElementById('registrationRate').textContent = regRate + '%';
            
            // Update notes for context
            const dateNote = currentDataSet === july17Data ? 'As of July 17' : 'Full year (Oct 31)';
            document.getElementById('applicantsNote').textContent = dateNote;
            document.getElementById('registeredNote').textContent = dateNote;
            document.getElementById('rateNote').textContent = year === '2025' && currentDataSet === july17Data ? 'Early in cycle' : '';
            document.getElementById('todayNote').textContent = currentDataSet === july17Data ? 'July 17 Daily Total' : 'N/A';
            
            // Calculate changes vs previous year
            const prevYear = year === '2025' ? '2024' : year === '2024' ? '2023' : year === '2023' ? '2019' : null;
            if (prevYear) {
                let prevApplicants = 0;
                let prevRegistered = 0;
                let prevTodayApplicants = 0;
                
                if (campus === 'all') {
                    for (const campusName in currentDataSet) {
                        if (currentDataSet[campusName][prevYear]) {
                            prevApplicants += currentDataSet[campusName][prevYear].accApplicants || 0;
                            prevRegistered += currentDataSet[campusName][prevYear].accRegistered || 0;
                            prevTodayApplicants += currentDataSet[campusName][prevYear].dailyApplicants || 0;
                        }
                    }
                } else {
                    if (currentDataSet[campus] && currentDataSet[campus][prevYear]) {
                        prevApplicants = currentDataSet[campus][prevYear].accApplicants || 0;
                        prevRegistered = currentDataSet[campus][prevYear].accRegistered || 0;
                        prevTodayApplicants = currentDataSet[campus][prevYear].dailyApplicants || 0;
                    }
                }
                
                const appChange = prevApplicants > 0 ? ((totalApplicants - prevApplicants) / prevApplicants * 100).toFixed(1) : 0;
                const regChange = prevRegistered > 0 ? ((totalRegistered - prevRegistered) / prevRegistered * 100).toFixed(1) : 0;
                const todayChange = prevTodayApplicants > 0 ? ((todayApplicants - prevTodayApplicants) / prevTodayApplicants * 100).toFixed(1) : 
                                    todayApplicants > 0 ? 'âˆž' : '0';
                
                document.getElementById('applicantsChange').innerHTML = appChange >= 0 ? 
                    `<span class="trend-up">â–² ${appChange}% vs ${prevYear}</span>` : 
                    `<span class="trend-down">â–¼ ${Math.abs(appChange)}% vs ${prevYear}</span>`;
                    
                document.getElementById('registeredChange').innerHTML = regChange >= 0 ? 
                    `<span class="trend-up">â–² ${regChange}% vs ${prevYear}</span>` : 
                    `<span class="trend-down">â–¼ ${Math.abs(regChange)}% vs ${prevYear}</span>`;
                
                if (currentDataSet === july17Data) {
                    if (todayChange === 'âˆž') {
                        document.getElementById('todayChange').innerHTML = `<span class="trend-up">â–² New applications vs ${prevYear}</span>`;
                    } else {
                        document.getElementById('todayChange').innerHTML = parseFloat(todayChange) >= 0 ? 
                            `<span class="trend-up">â–² ${todayChange}% vs ${prevYear}</span>` : 
                            `<span class="trend-down">â–¼ ${Math.abs(todayChange)}% vs ${prevYear}</span>`;
                    }
                } else {
                    document.getElementById('todayChange').innerHTML = '';
                }
            }
            
            // Update charts
            updateCharts(campus, year);
            updateWeeklyPatterns(campus, year);
            updateDailyPerformance(campus, year);
        }
        
        // Show year comparison
        function showYearComparison(campus) {
            const years = ['2019', '2023', '2024', '2025'];
            const applicantsData = [];
            const registeredData = [];
            const regRateData = [];
            
            years.forEach(year => {
                let totalApplicants = 0;
                let totalRegistered = 0;
                
                if (campus === 'all') {
                    for (const campusName in currentDataSet) {
                        if (currentDataSet[campusName][year]) {
                            totalApplicants += currentDataSet[campusName][year].accApplicants || 0;
                            totalRegistered += currentDataSet[campusName][year].accRegistered || 0;
                        }
                    }
                } else {
                    if (currentDataSet[campus] && currentDataSet[campus][year]) {
                        totalApplicants = currentDataSet[campus][year].accApplicants || 0;
                        totalRegistered = currentDataSet[campus][year].accRegistered || 0;
                    }
                }
                
                applicantsData.push(totalApplicants);
                registeredData.push(totalRegistered);
                regRateData.push(totalApplicants > 0 ? ((totalRegistered / totalApplicants) * 100).toFixed(1) : 0);
            });
            
            // Update applicants trend chart
            if (applicantsChart) applicantsChart.data = {
                labels: years.map(y => `Fall ${y}-${parseInt(y) + 1}`),
                datasets: [
                    {
                        label: 'Total Applicants',
                        data: applicantsData,
                        borderColor: 'rgba(52, 152, 219, 1)',
                        backgroundColor: 'rgba(52, 152, 219, 0.1)',
                        tension: 0.4,
                        fill: true,
                        pointRadius: 6,
                        pointHoverRadius: 8
                    },
                    {
                        label: 'Total Registered',
                        data: registeredData,
                        borderColor: 'rgba(46, 204, 113, 1)',
                        backgroundColor: 'rgba(46, 204, 113, 0.1)',
                        tension: 0.4,
                        fill: true,
                        pointRadius: 6,
                        pointHoverRadius: 8
                    }
                ]
            };
            if (applicantsChart) applicantsChart.update();
            
            // Update registration rate chart
            if (registrationChart) registrationChart.data = {
                labels: years.map(y => `Fall ${y}-${parseInt(y) + 1}`),
                datasets: [{
                    label: 'Registration Rate %',
                    data: regRateData,
                    backgroundColor: 'rgba(243, 156, 18, 0.8)',
                    borderColor: 'rgba(243, 156, 18, 1)',
                    borderWidth: 2
                }]
            };
            if (registrationChart) registrationChart.update();
            
            // Update comparison charts
            if (campusComparisonChart) campusComparisonChart.data = {
                labels: years.map(y => `Fall ${y}-${parseInt(y) + 1}`),
                datasets: [
                    {
                        label: 'Applicants',
                        data: applicantsData,
                        backgroundColor: 'rgba(52, 152, 219, 0.8)',
                        borderColor: 'rgba(52, 152, 219, 1)',
                        borderWidth: 2
                    },
                    {
                        label: 'Registered',
                        data: registeredData,
                        backgroundColor: 'rgba(46, 204, 113, 0.8)',
                        borderColor: 'rgba(46, 204, 113, 1)',
                        borderWidth: 2
                    }
                ]
            };
            if (campusComparisonChart) campusComparisonChart.update();
            
            // Update daily comparison charts if viewing comparable data
            if (currentDataSet === july17Data) {
                // Year comparison of daily applicants
                const dailyTotals = years.map(y => {
                    let total = 0;
                    for (const c in july17Data) {
                        total += july17Data[c][y]?.dailyApplicants || 0;
                    }
                    return total;
                });
                
                if (dailyComparisonChart) dailyComparisonChart.data = {
                    labels: years.map(y => `Fall ${y}-${parseInt(y) + 1}`),
                    datasets: [{
                        label: 'Daily Applications on July 17',
                        data: dailyTotals,
                        backgroundColor: [
                            'rgba(155, 89, 182, 0.8)',
                            'rgba(52, 152, 219, 0.8)',
                            'rgba(46, 204, 113, 0.8)',
                            'rgba(243, 156, 18, 0.8)'
                        ],
                        borderColor: [
                            'rgba(155, 89, 182, 1)',
                            'rgba(52, 152, 219, 1)',
                            'rgba(46, 204, 113, 1)',
                            'rgba(243, 156, 18, 1)'
                        ],
                        borderWidth: 2
                    }]
                };
                if (dailyComparisonChart) dailyComparisonChart.update();
                
                // Campus daily applicants for 2025
                const dailyCampusData = [];
                for (const c in july17Data) {
                    if (july17Data[c]['2025']?.dailyApplicants > 0) {
                        dailyCampusData.push({
                            name: c,
                            daily: july17Data[c]['2025'].dailyApplicants
                        });
                    }
                }
                
                dailyCampusData.sort((a, b) => b.daily - a.daily);
                
                if (dailyCampusChart) dailyCampusChart.data = {
                    labels: dailyCampusData.map(d => d.name),
                    datasets: [{
                        label: 'Daily Applications',
                        data: dailyCampusData.map(d => d.daily),
                        backgroundColor: 'rgba(231, 76, 60, 0.8)',
                        borderColor: 'rgba(231, 76, 60, 1)',
                        borderWidth: 2
                    }]
                };
                if (dailyCampusChart) dailyCampusChart.update();
            }
            
            // Update current year stats
            showYearData(campus, '2025');
            
            // Update weekly patterns for comparison view
            updateWeeklyPatterns(campus, 'compare');
            
            // Update daily performance for comparison view
            updateDailyPerformance(campus, 'compare');
        }
        
        // Update charts
        function updateCharts(campus, year) {
            // Get campus data and sort by applicants for current year
            const campusData = [];
            for (const campusName in currentDataSet) {
                if (currentDataSet[campusName][year]) {
                    campusData.push({
                        name: campusName,
                        applicants: currentDataSet[campusName][year].accApplicants || 0,
                        registered: currentDataSet[campusName][year].accRegistered || 0,
                        dailyApplicants: currentDataSet[campusName][year].dailyApplicants || 0
                    });
                }
            }
            
            // Sort by applicants (highest to lowest)
            campusData.sort((a, b) => b.applicants - a.applicants);
            
            const sortedCampuses = campusData.map(d => d.name);
            const campusApplicants = campusData.map(d => d.applicants);
            const campusRegistered = campusData.map(d => d.registered);
            
            if (campusComparisonChart) campusComparisonChart.data = {
                labels: sortedCampuses,
                datasets: [
                    {
                        label: 'Applicants',
                        data: campusApplicants,
                        backgroundColor: 'rgba(52, 152, 219, 0.8)',
                        borderColor: 'rgba(52, 152, 219, 1)',
                        borderWidth: 2
                    },
                    {
                        label: 'Registered',
                        data: campusRegistered,
                        backgroundColor: 'rgba(46, 204, 113, 0.8)',
                        borderColor: 'rgba(46, 204, 113, 1)',
                        borderWidth: 2
                    }
                ]
            };
            if (campusComparisonChart) campusComparisonChart.update();
            
            // Update daily comparison charts
            if (currentDataSet === july17Data) {
                // Year comparison of daily applicants
                const years = ['2019', '2023', '2024', '2025'];
                const dailyTotals = years.map(y => {
                    let total = 0;
                    for (const c in july17Data) {
                        total += july17Data[c][y]?.dailyApplicants || 0;
                    }
                    return total;
                });
                
                if (dailyComparisonChart) dailyComparisonChart.data = {
                    labels: years.map(y => `Fall ${y}-${parseInt(y) + 1}`),
                    datasets: [{
                        label: 'Daily Applications on July 17',
                        data: dailyTotals,
                        backgroundColor: [
                            'rgba(155, 89, 182, 0.8)',
                            'rgba(52, 152, 219, 0.8)',
                            'rgba(46, 204, 113, 0.8)',
                            'rgba(243, 156, 18, 0.8)'
                        ],
                        borderColor: [
                            'rgba(155, 89, 182, 1)',
                            'rgba(52, 152, 219, 1)',
                            'rgba(46, 204, 113, 1)',
                            'rgba(243, 156, 18, 1)'
                        ],
                        borderWidth: 2
                    }]
                };
                if (dailyComparisonChart) dailyComparisonChart.update();
                
                // Campus daily applicants for current year
                const dailyCampusData = campusData.filter(d => d.dailyApplicants > 0)
                    .sort((a, b) => b.dailyApplicants - a.dailyApplicants);
                
                if (dailyCampusChart) dailyCampusChart.data = {
                    labels: dailyCampusData.map(d => d.name),
                    datasets: [{
                        label: 'Daily Applications',
                        data: dailyCampusData.map(d => d.dailyApplicants),
                        backgroundColor: 'rgba(231, 76, 60, 0.8)',
                        borderColor: 'rgba(231, 76, 60, 1)',
                        borderWidth: 2
                    }]
                };
                if (dailyCampusChart) dailyCampusChart.update();
            }
            
            // For single year view, show year comparison
            if (year !== 'compare') {
                const years = ['2019', '2023', '2024', '2025'];
                const yearData = [];
                const yearRegData = [];
                
                years.forEach(y => {
                    if (campus === 'all') {
                        let totalApp = 0;
                        let totalReg = 0;
                        for (const c in currentDataSet) {
                            if (currentDataSet[c][y]) {
                                totalApp += currentDataSet[c][y].accApplicants || 0;
                                totalReg += currentDataSet[c][y].accRegistered || 0;
                            }
                        }
                        yearData.push(totalApp);
                        yearRegData.push(totalReg);
                    } else if (currentDataSet[campus] && currentDataSet[campus][y]) {
                        yearData.push(currentDataSet[campus][y].accApplicants || 0);
                        yearRegData.push(currentDataSet[campus][y].accRegistered || 0);
                    } else {
                        yearData.push(0);
                        yearRegData.push(0);
                    }
                });
                
                if (applicantsChart) applicantsChart.data = {
                    labels: years.map(y => `Fall ${y}`),
                    datasets: [{
                        label: campus === 'all' ? 'All Campuses' : campus,
                        data: yearData,
                        borderColor: 'rgba(52, 152, 219, 1)',
                        backgroundColor: 'rgba(52, 152, 219, 0.1)',
                        tension: 0.4,
                        fill: true,
                        pointRadius: 6,
                        pointHoverRadius: 8
                    }]
                };
                if (applicantsChart) applicantsChart.update();
                
                const regRates = yearData.map((app, i) => app > 0 ? ((yearRegData[i] / app) * 100).toFixed(1) : 0);
                if (registrationChart) registrationChart.data = {
                    labels: years.map(y => `Fall ${y}`),
                    datasets: [{
                        label: 'Registration Rate %',
                        data: regRates,
                        backgroundColor: 'rgba(243, 156, 18, 0.8)',
                        borderColor: 'rgba(243, 156, 18, 1)',
                        borderWidth: 2
                    }]
                };
                if (registrationChart) registrationChart.update();
            }
        }
        
        // Analyze and update weekly patterns
        function updateWeeklyPatterns(campus, year) {
            // Hard-coded weekly pattern data based on CSV analysis
            const weeklyPatterns = {
                "2025": {
                    overall: { Mon: 0.5, Tue: 0.6, Wed: 0.8, Thu: 0.5, Fri: 0.2, Sat: 0.1, Sun: 0.1 },
                    Beirut: { Mon: 2.5, Tue: 2.8, Wed: 3.8, Thu: 2.4, Fri: 0.9, Sat: 0.4, Sun: 0.5 },
                    Tripoli: { Mon: 0.1, Tue: 0.2, Wed: 0.1, Thu: 0.1, Fri: 0.0, Sat: 0.0, Sun: 0.0 },
                    "Mount Lebanon": { Mon: 0.3, Tue: 0.4, Wed: 0.3, Thu: 0.2, Fri: 0.1, Sat: 0.0, Sun: 0.1 },
                    Saida: { Mon: 0.5, Tue: 0.5, Wed: 0.6, Thu: 0.4, Fri: 0.1, Sat: 0.0, Sun: 0.0 },
                    Nabatieh: { Mon: 0.3, Tue: 0.3, Wed: 0.4, Thu: 0.3, Fri: 0.1, Sat: 0.0, Sun: 0.0 },
                    Tyre: { Mon: 0.2, Tue: 0.3, Wed: 0.4, Thu: 0.2, Fri: 0.1, Sat: 0.0, Sun: 0.0 },
                    Akkar: { Mon: 0.1, Tue: 0.1, Wed: 0.2, Thu: 0.1, Fri: 0.0, Sat: 0.0, Sun: 0.0 }
                },
                "2024": {
                    overall: { Mon: 12.9, Tue: 12.6, Wed: 9.0, Thu: 9.8, Fri: 3.1, Sat: 0.7, Sun: 0.8 },
                    Beirut: { Mon: 33.3, Tue: 33.6, Wed: 22.8, Thu: 25.1, Fri: 7.7, Sat: 1.8, Sun: 2.1 },
                    Tripoli: { Mon: 14.8, Tue: 14.0, Wed: 10.9, Thu: 11.1, Fri: 3.8, Sat: 0.9, Sun: 0.9 },
                    "Mount Lebanon": { Mon: 4.1, Tue: 4.3, Wed: 3.1, Thu: 3.3, Fri: 1.1, Sat: 0.2, Sun: 0.3 },
                    Saida: { Mon: 13.3, Tue: 12.6, Wed: 9.2, Thu: 10.0, Fri: 3.1, Sat: 0.7, Sun: 0.8 },
                    Nabatieh: { Mon: 7.3, Tue: 6.9, Wed: 5.0, Thu: 5.5, Fri: 1.7, Sat: 0.4, Sun: 0.4 },
                    Tyre: { Mon: 12.6, Tue: 11.9, Wed: 8.6, Thu: 9.4, Fri: 2.9, Sat: 0.7, Sun: 0.7 },
                    Akkar: { Mon: 5.0, Tue: 4.7, Wed: 3.4, Thu: 3.7, Fri: 1.2, Sat: 0.3, Sun: 0.3 }
                },
                "2023": {
                    overall: { Mon: 16.7, Tue: 12.3, Wed: 11.7, Thu: 12.1, Fri: 4.5, Sat: 1.8, Sun: 1.5 },
                    Beirut: { Mon: 44.6, Tue: 31.9, Wed: 30.3, Thu: 31.4, Fri: 11.7, Sat: 4.7, Sun: 3.9 },
                    Tripoli: { Mon: 21.2, Tue: 16.1, Wed: 15.1, Thu: 15.6, Fri: 5.8, Sat: 2.3, Sun: 1.9 },
                    "Mount Lebanon": { Mon: 4.6, Tue: 3.5, Wed: 3.3, Thu: 3.4, Fri: 1.3, Sat: 0.5, Sun: 0.4 },
                    Saida: { Mon: 18.0, Tue: 13.6, Wed: 12.9, Thu: 13.4, Fri: 5.0, Sat: 2.0, Sun: 1.7 },
                    Nabatieh: { Mon: 11.0, Tue: 8.3, Wed: 7.9, Thu: 8.2, Fri: 3.1, Sat: 1.2, Sun: 1.0 },
                    Tyre: { Mon: 13.7, Tue: 10.4, Wed: 9.8, Thu: 10.2, Fri: 3.8, Sat: 1.5, Sun: 1.3 },
                    Akkar: { Mon: 5.8, Tue: 6.6, Wed: 6.4, Thu: 6.0, Fri: 2.2, Sat: 0.9, Sun: 0.7 }
                },
                "2019": {
                    overall: { Mon: 13.9, Tue: 13.0, Wed: 15.2, Thu: 13.6, Fri: 11.2, Sat: 0.5, Sun: 0.4 },
                    Beirut: { Mon: 54.0, Tue: 49.5, Wed: 58.1, Thu: 51.9, Fri: 42.7, Sat: 1.9, Sun: 1.4 },
                    Tripoli: { Mon: 15.8, Tue: 15.1, Wed: 17.3, Thu: 15.5, Fri: 16.2, Sat: 0.6, Sun: 0.4 },
                    "Mount Lebanon": { Mon: 6.0, Tue: 5.6, Wed: 6.6, Thu: 5.9, Fri: 4.8, Sat: 0.2, Sun: 0.2 },
                    Saida: { Mon: 17.9, Tue: 19.2, Wed: 20.1, Thu: 18.0, Fri: 14.8, Sat: 0.7, Sun: 0.5 },
                    Nabatieh: { Mon: 17.0, Tue: 15.9, Wed: 18.6, Thu: 17.6, Fri: 14.0, Sat: 0.6, Sun: 0.5 },
                    Tyre: { Mon: 23.0, Tue: 21.6, Wed: 26.0, Thu: 22.7, Fri: 18.7, Sat: 0.8, Sun: 0.6 },
                    Akkar: { Mon: 5.8, Tue: 5.4, Wed: 6.6, Thu: 5.7, Fri: 4.7, Sat: 0.2, Sun: 0.2 }
                }
            };
            
            const days = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'];
            const yearData = weeklyPatterns[year];
            
            if (!yearData) return;
            
            // Update weekly pattern chart
            if (campus === 'all' || campus === 'compare') {
                // Show overall pattern for all years
                const datasets = [];
                const colors = {
                    '2025': 'rgba(243, 156, 18, 0.8)',
                    '2024': 'rgba(46, 204, 113, 0.8)',
                    '2023': 'rgba(52, 152, 219, 0.8)',
                    '2019': 'rgba(155, 89, 182, 0.8)'
                };
                
                if (year === 'compare') {
                    // Compare all years
                    ['2019', '2023', '2024', '2025'].forEach(y => {
                        if (weeklyPatterns[y]) {
                            datasets.push({
                                label: `Fall ${y}`,
                                data: days.map(d => weeklyPatterns[y].overall[d]),
                                backgroundColor: colors[y],
                                borderColor: colors[y].replace('0.8', '1'),
                                borderWidth: 2
                            });
                        }
                    });
                } else {
                    // Single year overall
                    datasets.push({
                        label: `Fall ${year} - All Campuses`,
                        data: days.map(d => yearData.overall[d]),
                        backgroundColor: colors[year] || 'rgba(52, 152, 219, 0.8)',
                        borderColor: (colors[year] || 'rgba(52, 152, 219, 0.8)').replace('0.8', '1'),
                        borderWidth: 2
                    });
                }
                
                if (weeklyPatternChart) weeklyPatternChart.data = {
                    labels: days,
                    datasets: datasets
                };
                if (weeklyPatternChart) weeklyPatternChart.update();
            } else {
                // Single campus pattern
                const campusData = yearData[campus];
                if (campusData) {
                    if (weeklyPatternChart) weeklyPatternChart.data = {
                        labels: days,
                        datasets: [{
                            label: `${campus} - Fall ${year}`,
                            data: days.map(d => campusData[d]),
                            backgroundColor: 'rgba(52, 152, 219, 0.8)',
                            borderColor: 'rgba(52, 152, 219, 1)',
                            borderWidth: 2
                        }]
                    };
                    if (weeklyPatternChart) weeklyPatternChart.update();
                }
            }
            
            // Update heatmap chart - show campus breakdown for current year
            if (year !== 'compare') {
                const campuses = ['Beirut', 'Tripoli', 'Mount Lebanon', 'Saida', 'Nabatieh', 'Tyre', 'Akkar'];
                const campusColors = [
                    'rgba(231, 76, 60, 0.8)',
                    'rgba(52, 152, 219, 0.8)',
                    'rgba(46, 204, 113, 0.8)',
                    'rgba(155, 89, 182, 0.8)',
                    'rgba(241, 196, 15, 0.8)',
                    'rgba(230, 126, 34, 0.8)',
                    'rgba(149, 165, 166, 0.8)'
                ];
                
                const datasets = campuses.map((camp, idx) => {
                    const campData = yearData[camp];
                    return {
                        label: camp,
                        data: days.map(d => campData ? campData[d] : 0),
                        backgroundColor: campusColors[idx],
                        borderColor: campusColors[idx].replace('0.8', '1'),
                        borderWidth: 1
                    };
                });
                
                if (weeklyHeatmapChart) weeklyHeatmapChart.data = {
                    labels: days,
                    datasets: datasets
                };
                if (weeklyHeatmapChart) weeklyHeatmapChart.update();
            } else {
                // In compare mode, show year comparison for peak days
                const peakDays = {};
                ['2019', '2023', '2024', '2025'].forEach(y => {
                    if (weeklyPatterns[y]) {
                        const yearPattern = weeklyPatterns[y].overall;
                        const maxDay = Object.entries(yearPattern).reduce((a, b) => 
                            yearPattern[a[0]] > yearPattern[b[0]] ? a : b
                        );
                        peakDays[y] = maxDay;
                    }
                });
                
                // Show peak day comparison
                if (weeklyHeatmapChart) weeklyHeatmapChart.data = {
                    labels: ['Peak Application Day'],
                    datasets: Object.entries(peakDays).map(([y, [day, val]]) => ({
                        label: `Fall ${y}: ${day} (${val} avg)`,
                        data: [val],
                        backgroundColor: {
                            '2025': 'rgba(243, 156, 18, 0.8)',
                            '2024': 'rgba(46, 204, 113, 0.8)',
                            '2023': 'rgba(52, 152, 219, 0.8)',
                            '2019': 'rgba(155, 89, 182, 0.8)'
                        }[y],
                        borderWidth: 2
                    }))
                };
                if (weeklyHeatmapChart) weeklyHeatmapChart.options.scales.x.stacked = false;
                if (weeklyHeatmapChart) weeklyHeatmapChart.options.scales.y.stacked = false;
                if (weeklyHeatmapChart) weeklyHeatmapChart.update();
            }
        }
        
        // Update daily performance analysis
        function updateDailyPerformance(campus, year) {
            // Day 33 data for all years
            const day33Data = {
                "2019": { total: 1084, registered: 533, daily: 68 },
                "2023": { total: 882, registered: 464, daily: 84 },
                "2024": { total: 577, registered: 396, daily: 5 },
                "2025": { total: 442, registered: 4, daily: 38 }
            };
            
            // Campus-specific day 33 data
            const campusDay33Data = {
                "Akkar": { "2024": { total: 6, daily: 0 }, "2025": { total: 8, daily: 1 } },
                "Beirut": { "2024": { total: 378, daily: 2 }, "2025": { total: 304, daily: 28 } },
                "Mount Lebanon": { "2024": { total: 47, daily: 0 }, "2025": { total: 28, daily: 0 } },
                "Nabatieh": { "2024": { total: 29, daily: 0 }, "2025": { total: 24, daily: 3 } },
                "Saida": { "2024": { total: 62, daily: 1 }, "2025": { total: 46, daily: 6 } },
                "Tripoli": { "2024": { total: 34, daily: 2 }, "2025": { total: 12, daily: 0 } },
                "Tyre": { "2024": { total: 21, daily: 0 }, "2025": { total: 20, daily: 0 } }
            };
            
            // Update performance cards
            const current2025 = day33Data["2025"].daily;
            const comparisons = {
                "2024": day33Data["2024"].daily,
                "2023": day33Data["2023"].daily,
                "2019": day33Data["2019"].daily
            };
            
            // Calculate changes
            const vs2024 = ((current2025 - comparisons["2024"]) / comparisons["2024"] * 100).toFixed(1);
            const vs2023 = ((current2025 - comparisons["2023"]) / comparisons["2023"] * 100).toFixed(1);
            const vs2019 = ((current2025 - comparisons["2019"]) / comparisons["2019"] * 100).toFixed(1);
            
            // Update card values
            document.getElementById('todayVs2024').textContent = vs2024 >= 0 ? `+${vs2024}%` : `${vs2024}%`;
            document.getElementById('todayVs2023').textContent = vs2023 >= 0 ? `+${vs2023}%` : `${vs2023}%`;
            document.getElementById('todayVs2019').textContent = vs2019 >= 0 ? `+${vs2019}%` : `${vs2019}%`;
            
            // Update card notes
            document.querySelector('#todayVs2024').nextElementSibling.nextElementSibling.textContent = 
                `${current2025} vs ${comparisons["2024"]} applications`;
            document.querySelector('#todayVs2023').nextElementSibling.nextElementSibling.textContent = 
                `${current2025} vs ${comparisons["2023"]} applications`;
            document.querySelector('#todayVs2019').nextElementSibling.nextElementSibling.textContent = 
                `${current2025} vs ${comparisons["2019"]} applications`;
            
            // Calculate performance index (current year vs 4-year average)
            const avgDaily = (comparisons["2024"] + comparisons["2023"] + comparisons["2019"]) / 3;
            const perfIndex = (current2025 / avgDaily * 100).toFixed(1);
            document.getElementById('performanceIndex').textContent = `${perfIndex}%`;
            
            // Color code the values
            ['todayVs2024', 'todayVs2023', 'todayVs2019'].forEach(id => {
                const element = document.getElementById(id);
                const value = parseFloat(element.textContent);
                element.style.color = value >= 0 ? '#27ae60' : '#e74c3c';
            });
            
            document.getElementById('performanceIndex').style.color = 
                parseFloat(perfIndex) >= 100 ? '#27ae60' : '#e74c3c';
            
            // Update cumulative comparison chart
            const cumulativeData = {
                labels: Array.from({length: 33}, (_, i) => `Day ${i + 1}`),
                datasets: [
                    {
                        label: 'Fall 2025',
                        data: [59, 66, 76, 90, 100, 108, 109, 110, 127, 143, 154, 156, 160, 160, 161, 174, 195, 219, 231, 238, 240, 244, 247, 262, 279, 286, 293, 298, 304, 329, 354, 404, 442],
                        borderColor: 'rgba(243, 156, 18, 1)',
                        backgroundColor: 'rgba(243, 156, 18, 0.1)',
                        tension: 0.4
                    },
                    {
                        label: 'Fall 2024',
                        data: [58, 58, 59, 61, 62, 70, 74, 75, 76, 88, 97, 105, 115, 123, 124, 127, 140, 158, 164, 196, 217, 221, 227, 233, 301, 362, 415, 434, 444, 448, 520, 572, 577],
                        borderColor: 'rgba(46, 204, 113, 1)',
                        backgroundColor: 'rgba(46, 204, 113, 0.1)',
                        tension: 0.4
                    },
                    {
                        label: 'Fall 2023',
                        data: [413, 426, 430, 438, 460, 475, 494, 507, 511, 515, 521, 538, 546, 548, 550, 557, 561, 568, 591, 620, 651, 668, 674, 680, 686, 706, 716, 737, 755, 769, 787, 798, 882],
                        borderColor: 'rgba(52, 152, 219, 1)',
                        backgroundColor: 'rgba(52, 152, 219, 0.1)',
                        tension: 0.4
                    },
                    {
                        label: 'Fall 2019',
                        data: [197, 198, 209, 220, 231, 240, 247, 247, 252, 266, 273, 296, 323, 350, 353, 355, 390, 426, 456, 482, 499, 499, 501, 550, 592, 648, 739, 781, 785, 789, 912, 1016, 1084],
                        borderColor: 'rgba(155, 89, 182, 1)',
                        backgroundColor: 'rgba(155, 89, 182, 0.1)',
                        tension: 0.4
                    }
                ]
            };
            
            // For simplicity, using approximated data - in real implementation, this would come from the CSV
            if (cumulativeComparisonChart) cumulativeComparisonChart.data = cumulativeData;
            if (cumulativeComparisonChart) cumulativeComparisonChart.update();
            
            // Update daily performance bar chart
            if (dailyPerformanceChart) dailyPerformanceChart.data = {
                labels: ['Fall 2019', 'Fall 2023', 'Fall 2024', 'Fall 2025'],
                datasets: [{
                    label: 'Day 33 Applications',
                    data: [68, 84, 5, 38],
                    backgroundColor: [
                        'rgba(155, 89, 182, 0.8)',
                        'rgba(52, 152, 219, 0.8)',
                        'rgba(46, 204, 113, 0.8)',
                        'rgba(243, 156, 18, 0.8)'
                    ],
                    borderColor: [
                        'rgba(155, 89, 182, 1)',
                        'rgba(52, 152, 219, 1)',
                        'rgba(46, 204, 113, 1)',
                        'rgba(243, 156, 18, 1)'
                    ],
                    borderWidth: 2
                }]
            };
            if (dailyPerformanceChart) dailyPerformanceChart.update();
            
            // Update projection chart
            const projectionData = [];
            const colors = [];
            ['2019', '2023', '2024', '2025'].forEach((y, idx) => {
                const currentTotal = day33Data[y].total;
                const dailyAvg = currentTotal / 33;
                const remainingDays = 139 - 33;
                const projected = currentTotal + (dailyAvg * remainingDays);
                projectionData.push(Math.round(projected));
                colors.push(['rgba(155, 89, 182, 0.8)', 'rgba(52, 152, 219, 0.8)', 
                            'rgba(46, 204, 113, 0.8)', 'rgba(243, 156, 18, 0.8)'][idx]);
            });
            
            if (projectionChart) projectionChart.data = {
                labels: ['Fall 2019', 'Fall 2023', 'Fall 2024', 'Fall 2025'],
                datasets: [{
                    label: 'Projected Total',
                    data: projectionData,
                    backgroundColor: colors,
                    borderColor: colors.map(c => c.replace('0.8', '1')),
                    borderWidth: 2
                }]
            };
            if (projectionChart) projectionChart.update();
            
            // Update campus performance heatmap
            const campuses = ['Beirut', 'Saida', 'Mount Lebanon', 'Nabatieh', 'Tyre', 'Tripoli', 'Akkar'];
            const performanceData = [];
            
            campuses.forEach(camp => {
                if (campusDay33Data[camp]) {
                    const current = campusDay33Data[camp]["2025"].total;
                    const previous = campusDay33Data[camp]["2024"].total;
                    const change = ((current - previous) / previous * 100).toFixed(1);
                    performanceData.push(parseFloat(change));
                }
            });
            
            if (campusPerformanceHeatmap) campusPerformanceHeatmap.data = {
                labels: campuses,
                datasets: [{
                    label: 'Performance vs Last Year (%)',
                    data: performanceData,
                    backgroundColor: performanceData.map(val => 
                        val >= 0 ? 'rgba(46, 204, 113, 0.8)' : 'rgba(231, 76, 60, 0.8)'
                    ),
                    borderColor: performanceData.map(val => 
                        val >= 0 ? 'rgba(46, 204, 113, 1)' : 'rgba(231, 76, 60, 1)'
                    ),
                    borderWidth: 2
                }]
            };
            if (campusPerformanceHeatmap) campusPerformanceHeatmap.update();
        }
        
        // Update campus table
        function updateCampusTable(year) {
            const tbody = document.getElementById('campusTableBody');
            tbody.innerHTML = '';
            
            const displayYear = year === 'compare' ? '2025' : year;
            const prevYear = displayYear === '2025' ? '2024' : displayYear === '2024' ? '2023' : displayYear === '2023' ? '2019' : null;
            
            // Get campus data and sort by applicants
            const campusData = [];
            for (const campus in currentDataSet) {
                if (currentDataSet[campus][displayYear]) {
                    const current = currentDataSet[campus][displayYear];
                    const prev = prevYear && currentDataSet[campus][prevYear] ? currentDataSet[campus][prevYear] : null;
                    const preCovid = currentDataSet[campus]['2019'] || null;
                    
                    campusData.push({
                        name: campus,
                        current: current,
                        prev: prev,
                        preCovid: preCovid,
                        applicants: current.accApplicants || 0
                    });
                }
            }
            
            // Sort by applicants (highest to lowest)
            campusData.sort((a, b) => b.applicants - a.applicants);
            
            // Create table rows
            campusData.forEach(item => {
                const current = item.current;
                const prev = item.prev;
                const preCovid = item.preCovid;
                
                const regRate = current.accApplicants > 0 ? ((current.accRegistered / current.accApplicants) * 100).toFixed(1) : 0;
                
                let changeText = '-';
                if (prev) {
                    const change = ((current.accApplicants - prev.accApplicants) / prev.accApplicants * 100).toFixed(1);
                    changeText = change >= 0 ? 
                        `<span class="trend-up">â–² ${change}%</span>` : 
                        `<span class="trend-down">â–¼ ${Math.abs(change)}%</span>`;
                }
                
                let covidChangeText = '-';
                if (preCovid && preCovid.accApplicants > 0) {
                    const covidChange = ((current.accApplicants - preCovid.accApplicants) / preCovid.accApplicants * 100).toFixed(1);
                    covidChangeText = covidChange >= 0 ? 
                        `<span class="trend-up">â–² ${covidChange}%</span>` : 
                        `<span class="trend-down">â–¼ ${Math.abs(covidChange)}%</span>`;
                }
                
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td>${item.name}</td>
                    <td>${current.accApplicants.toLocaleString()}</td>
                    <td>${current.accRegistered.toLocaleString()}</td>
                    <td>${regRate}%</td>
                    <td>${changeText}</td>
                    <td>${covidChangeText}</td>
                `;
            });
        }
        
        // Initialize dashboard
        function init() {
            initCharts();
            updateDashboard();
            
            // Add event listeners
            document.getElementById('campusFilter').addEventListener('change', updateDashboard);
            document.getElementById('yearFilter').addEventListener('change', updateDashboard);
            document.getElementById('dateFilter').addEventListener('change', updateDashboard);
        }
        
        // Start the dashboard with error handling
        window.addEventListener('DOMContentLoaded', function() {
            try {
                console.log('Initializing dashboard...');
                console.log('Chart.js loaded:', typeof Chart !== 'undefined');
                console.log('Data loaded:', typeof july17Data !== 'undefined');
                init();
                console.log('Dashboard initialized successfully');
            } catch (error) {
                console.error('Error initializing dashboard:', error);
                alert('Error loading dashboard: ' + error.message);
            }
        });
    </script>
</body>
</html>