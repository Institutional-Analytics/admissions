<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Executive Admissions Dashboard</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background-color: #f0f2f5;
            color: #1a1a1a;
            line-height: 1.6;
        }
        
        .dashboard-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 1rem;
        }
        
        /* Header */
        .dashboard-header {
            background: white;
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            margin-bottom: 1rem;
        }
        
        .header-content {
            text-align: center;
        }
        
        .header-title h1 {
            font-size: 1.75rem;
            font-weight: 700;
            color: #1a1a1a;
            margin-bottom: 0.25rem;
        }
        
        .header-subtitle {
            color: #6b7280;
            font-size: 0.95rem;
        }
        
        /* Cycle Progress Bar */
        .cycle-progress-section {
            background: white;
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            margin-bottom: 1.5rem;
        }
        
        .cycle-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            flex-wrap: wrap;
            gap: 1rem;
        }
        
        .cycle-header h2 {
            font-size: 1.125rem;
            font-weight: 600;
            margin: 0;
        }
        
        .cycle-stats {
            display: flex;
            gap: 0.75rem;
            align-items: center;
            font-size: 0.95rem;
        }
        
        .cycle-stat {
            color: #4b5563;
        }
        
        .progress-bar-container {
            background: #e5e7eb;
            height: 32px;
            border-radius: 16px;
            overflow: hidden;
            position: relative;
            margin-bottom: 0.75rem;
        }
        
        .progress-bar-fill {
            background: linear-gradient(90deg, #3b82f6 0%, #2563eb 100%);
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 1rem;
            transition: width 0.3s ease;
        }
        
        .progress-label {
            color: white;
            font-weight: 600;
            font-size: 0.875rem;
        }
        
        .cycle-dates {
            display: flex;
            justify-content: space-between;
            font-size: 0.875rem;
            color: #6b7280;
        }
        
        /* Alerts Section */
        .alerts-section {
            background: white;
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            margin-bottom: 1.5rem;
        }
        
        .alerts-header {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }
        
        .alert-icon {
            width: 24px;
            height: 24px;
            background: #ef4444;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 14px;
        }
        
        .alerts-title {
            font-size: 1.125rem;
            font-weight: 600;
        }
        
        .alert-item {
            display: flex;
            align-items: flex-start;
            gap: 0.75rem;
            padding: 0.75rem 0;
            border-bottom: 1px solid #f3f4f6;
        }
        
        .alert-item:last-child {
            border-bottom: none;
        }
        
        .alert-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-top: 0.5rem;
            flex-shrink: 0;
        }
        
        .alert-indicator.critical { background: #ef4444; }
        .alert-indicator.warning { background: #f59e0b; }
        .alert-indicator.positive { background: #10b981; }
        
        .alert-content {
            flex: 1;
        }
        
        .alert-message {
            font-size: 0.95rem;
            margin-bottom: 0.25rem;
        }
        
        .alert-detail {
            font-size: 0.875rem;
            color: #6b7280;
        }
        
        /* Key Metrics Section */
        .metrics-section {
            background: white;
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            margin-bottom: 1.5rem;
        }
        
        /* Divider styles */
        .section-divider {
            height: 1px;
            background: linear-gradient(to right, transparent, #e5e7eb 20%, #e5e7eb 80%, transparent);
            margin: 2rem 0;
        }
        
        .chart-divider {
            height: 1px;
            background: #e5e7eb;
            margin: 2rem 0;
            position: relative;
        }
        
        .expandable-content .chart-divider {
            margin: 2rem 0;
        }
        
        .metrics-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }
        
        .metrics-title {
            font-size: 1.125rem;
            font-weight: 600;
        }
        
        .view-toggle {
            display: flex;
            background: #f3f4f6;
            border-radius: 8px;
            padding: 0.25rem;
        }
        
        .view-toggle button {
            padding: 0.5rem 1rem;
            border: none;
            background: transparent;
            color: #6b7280;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            border-radius: 6px;
            transition: all 0.2s;
        }
        
        .view-toggle button.active {
            background: white;
            color: #1a1a1a;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        
        .metric-card {
            padding: 1.25rem;
            border-radius: 10px;
            background: #f8f9fa;
            position: relative;
            overflow: hidden;
        }
        
        .metric-card.critical {
            background: #fee2e2;
            border: 1px solid #fecaca;
        }
        
        .metric-card.warning {
            background: #fef3c7;
            border: 1px solid #fde68a;
        }
        
        .metric-card.positive {
            background: #d1fae5;
            border: 1px solid #a7f3d0;
        }
        
        .metric-label {
            font-size: 0.875rem;
            color: #6b7280;
            margin-bottom: 0.5rem;
        }
        
        .metric-value {
            font-size: 2rem;
            font-weight: 700;
            line-height: 1.2;
            margin-bottom: 0.5rem;
        }
        
        .metric-change {
            font-size: 0.875rem;
            font-weight: 500;
        }
        
        .metric-change.positive { color: #10b981; }
        .metric-change.negative { color: #ef4444; }
        
        .metric-spark {
            position: absolute;
            bottom: 0;
            right: 0;
            opacity: 0.3;
        }
        
        /* Expandable Sections */
        .expandable-section {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            margin-bottom: 1.5rem;
            overflow: hidden;
        }
        
        .expandable-header {
            padding: 1.5rem;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background-color 0.2s;
        }
        
        .expandable-header:hover {
            background-color: #f8f9fa;
        }
        
        .expandable-title {
            font-size: 1.125rem;
            font-weight: 600;
        }
        
        .expand-icon {
            width: 24px;
            height: 24px;
            transition: transform 0.3s;
        }
        
        .expandable-header.expanded .expand-icon {
            transform: rotate(180deg);
        }
        
        .expandable-content {
            padding: 0 1.5rem;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out, padding 0.3s ease-out;
        }
        
        .expandable-content.expanded {
            max-height: 2000px;
            padding: 0 1.5rem 1.5rem 1.5rem;
        }
        
        /* Charts */
        .chart-container {
            position: relative;
            height: 300px;
            margin: 1rem 0;
        }
        
        .chart-container.small {
            height: 200px;
        }
        
        /* Tables */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }
        
        .data-table th {
            background: #f8f9fa;
            padding: 0.75rem;
            text-align: left;
            font-weight: 600;
            font-size: 0.875rem;
            border-bottom: 2px solid #e5e7eb;
        }
        
        .data-table td {
            padding: 0.75rem;
            border-bottom: 1px solid #f3f4f6;
            font-size: 0.875rem;
        }
        
        .data-table tr:hover {
            background: #f8f9fa;
        }
        
        /* Utility Classes */
        .text-positive { color: #10b981; }
        .text-negative { color: #ef4444; }
        .text-muted { color: #6b7280; }
        
        /* Mobile Responsive */
        @media (max-width: 768px) {
            .dashboard-container {
                padding: 0.5rem;
            }
            
            .header-content {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .metrics-grid {
                grid-template-columns: 1fr;
            }
            
            .view-toggle {
                flex-wrap: wrap;
            }
            
            .view-toggle button {
                flex: 1;
                min-width: 80px;
            }
        }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <!-- Header -->
        <div class="dashboard-header">
            <div class="header-content">
                <div class="header-title">
                    <h1>Executive Admissions Dashboard</h1>
                    <div class="header-subtitle">Fall 2025-2026 Admissions Cycle • Last updated: 07#22 at 10:00 AM</div>
                </div>
            </div>
        </div>
        
        <!-- Cycle Progress Bar -->
        <div class="cycle-progress-section">
            <div class="cycle-header">
                <h2>Admission Cycle Progress</h2>
                <div class="cycle-stats">
                    <span class="cycle-stat"><strong>Day 38</strong> of 139</span>
                    <span class="cycle-stat">•</span>
                    <span class="cycle-stat"><strong>27.3%</strong> Complete</span>
                    <span class="cycle-stat">•</span>
                    <span class="cycle-stat"><strong>101 days</strong> Remaining</span>
                </div>
            </div>
            <div class="progress-bar-container">
                <div class="progress-bar-fill" style="width: 27.3%">
                    <span class="progress-label">27.3%</span>
                </div>
            </div>
            <div class="cycle-dates">
                <span>Start: June 15</span>
                <span>Current: July 21 (Day 38)</span>
                <span>End: October 31 (Day 38)</span>
            </div>
        </div>
        
        <div class="section-divider"></div>
        
        <!-- Alerts Section -->
        <div class="alerts-section">
            <div class="alerts-header">
                <div class="alert-icon">!</div>
                <h2 class="alerts-title">Key Insights & Actions Required</h2>
            </div>
            <div id="alertsContainer">
                <!-- Alerts will be dynamically populated -->
            </div>
        </div>
        
        <div class="section-divider"></div>
        
        <!-- Key Metrics Section -->
        <div class="metrics-section">
            <div class="metrics-header">
                <h2 class="metrics-title">Key Performance Metrics</h2>
                <div class="view-toggle">
                    <button class="active" onclick="changeView('daily')">Daily</button>
                    <button onclick="changeView('weekly')">Weekly</button>
                    <button onclick="changeView('monthly')">Monthly</button>
                </div>
            </div>
            <div class="metrics-grid" id="metricsGrid">
                <!-- Metrics will be dynamically populated -->
            </div>
            <div class="chart-divider"></div>
            <div class="chart-container small">
                <canvas id="trendChart"></canvas>
            </div>
            <div class="chart-divider"></div>
            <div class="chart-container" style="height: 500px;">
                <canvas id="cumulativeChart"></canvas>
            </div>
        </div>
        
        <!-- Campus Performance (Expandable) -->
        <div class="expandable-section">
            <div class="expandable-header" onclick="toggleSection('campus')">
                <h2 class="expandable-title">Campus Performance Details</h2>
                <svg class="expand-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                </svg>
            </div>
            <div class="expandable-content" id="campusContent">
                <table class="data-table" id="campusTable">
                    <!-- Campus data will be populated here -->
                </table>
                <div class="chart-divider"></div>
                <div class="chart-container">
                    <canvas id="campusChart"></canvas>
                </div>
            </div>
        </div>
        
        <!-- Historical Trends (Expandable) -->
        <div class="expandable-section">
            <div class="expandable-header" onclick="toggleSection('trends')">
                <h2 class="expandable-title">Historical Trends & Projections</h2>
                <svg class="expand-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                </svg>
            </div>
            <div class="expandable-content" id="trendsContent">
                <div class="chart-container">
                    <canvas id="historicalChart"></canvas>
                </div>
                <div class="chart-divider"></div>
                <div class="chart-container">
                    <canvas id="projectionChart"></canvas>
                </div>
            </div>
        </div>
        
        <!-- Detailed Analytics (Expandable) -->
        <div class="expandable-section">
            <div class="expandable-header" onclick="toggleSection('analytics')">
                <h2 class="expandable-title">Detailed Analytics</h2>
                <svg class="expand-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                </svg>
            </div>
            <div class="expandable-content" id="analyticsContent">
                <div class="metrics-grid" style="grid-template-columns: 1fr; gap: 0;">
                    <div class="chart-container">
                        <canvas id="weekPatternChart"></canvas>
                    </div>
                    <div class="chart-divider"></div>
                    <div class="chart-container">
                        <canvas id="conversionChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // Data from the updated dashboard (July 21, 2025 - Day 38)
        const july21Data = {
            "Akkar": {
                "2019": {
                    "accApplicants": 7,
                    "accRegistered": 3,
                    "dailyApplicants": 0
                },
                "2023": {
                    "accApplicants": 8,
                    "accRegistered": 3,
                    "dailyApplicants": 1
                },
                "2024": {
                    "accApplicants": 8,
                    "accRegistered": 5,
                    "dailyApplicants": 0
                },
                "2025": {
                    "accApplicants": 12,
                    "accRegistered": 3,
                    "dailyApplicants": 1
                }
            },
            "Beirut": {
                "2019": {
                    "accApplicants": 966,
                    "accRegistered": 555,
                    "dailyApplicants": 2
                },
                "2023": {
                    "accApplicants": 644,
                    "accRegistered": 400,
                    "dailyApplicants": 25
                },
                "2024": {
                    "accApplicants": 460,
                    "accRegistered": 319,
                    "dailyApplicants": 1
                },
                "2025": {
                    "accApplicants": 454,
                    "accRegistered": 26,
                    "dailyApplicants": 54
                }
            },
            "Mount Lebanon": {
                "2019": {
                    "accApplicants": 73,
                    "accRegistered": 40,
                    "dailyApplicants": 0
                },
                "2023": {
                    "accApplicants": 85,
                    "accRegistered": 60,
                    "dailyApplicants": 0
                },
                "2024": {
                    "accApplicants": 52,
                    "accRegistered": 44,
                    "dailyApplicants": 0
                },
                "2025": {
                    "accApplicants": 41,
                    "accRegistered": 3,
                    "dailyApplicants": 8
                }
            },
            "Nabatieh": {
                "2019": {
                    "accApplicants": 22,
                    "accRegistered": 5,
                    "dailyApplicants": 0
                },
                "2023": {
                    "accApplicants": 75,
                    "accRegistered": 36,
                    "dailyApplicants": 2
                },
                "2024": {
                    "accApplicants": 42,
                    "accRegistered": 17,
                    "dailyApplicants": 1
                },
                "2025": {
                    "accApplicants": 35,
                    "accRegistered": 0,
                    "dailyApplicants": 1
                }
            },
            "Saida": {
                "2019": {
                    "accApplicants": 80,
                    "accRegistered": 4,
                    "dailyApplicants": 1
                },
                "2023": {
                    "accApplicants": 119,
                    "accRegistered": 64,
                    "dailyApplicants": 1
                },
                "2024": {
                    "accApplicants": 84,
                    "accRegistered": 65,
                    "dailyApplicants": 2
                },
                "2025": {
                    "accApplicants": 65,
                    "accRegistered": 0,
                    "dailyApplicants": 10
                }
            },
            "Tripoli": {
                "2019": {
                    "accApplicants": 47,
                    "accRegistered": 3,
                    "dailyApplicants": 0
                },
                "2023": {
                    "accApplicants": 108,
                    "accRegistered": 19,
                    "dailyApplicants": 4
                },
                "2024": {
                    "accApplicants": 37,
                    "accRegistered": 18,
                    "dailyApplicants": 0
                },
                "2025": {
                    "accApplicants": 23,
                    "accRegistered": 0,
                    "dailyApplicants": 3
                }
            },
            "Tyre": {
                "2019": {
                    "accApplicants": 18,
                    "accRegistered": 3,
                    "dailyApplicants": 0
                },
                "2023": {
                    "accApplicants": 61,
                    "accRegistered": 31,
                    "dailyApplicants": 1
                },
                "2024": {
                    "accApplicants": 21,
                    "accRegistered": 7,
                    "dailyApplicants": 0
                },
                "2025": {
                    "accApplicants": 30,
                    "accRegistered": 0,
                    "dailyApplicants": 3
                }
            }
        };

        // Global variables
        let currentView = 'daily';
        let charts = {};
        let metrics = {};
        
        // Calculate totals and metrics
        function calculateMetrics() {
            const localMetrics = {};
            
            // Current year totals
            let total2025 = 0;
            let registered2025 = 0;
            let daily2025 = 0;
            
            // Previous years for comparison
            let total2024 = 0;
            let registered2024 = 0;
            let total2023 = 0;
            let total2019 = 0;
            
            for (const campus in july21Data) {
                total2025 += july21Data[campus]["2025"].accApplicants || 0;
                registered2025 += july21Data[campus]["2025"].accRegistered || 0;
                daily2025 += july21Data[campus]["2025"].dailyApplicants || 0;
                
                total2024 += july21Data[campus]["2024"].accApplicants || 0;
                registered2024 += july21Data[campus]["2024"].accRegistered || 0;
                total2023 += july21Data[campus]["2023"].accApplicants || 0;
                total2019 += july21Data[campus]["2019"].accApplicants || 0;
            }
            
            localMetrics.total = total2025;
            localMetrics.registered = registered2025;
            localMetrics.daily = daily2025;
            localMetrics.registrationRate = total2025 > 0 ? (registered2025 / total2025 * 100).toFixed(1) : 0;
            
            // Calculate averages
            localMetrics.dailyAvg = (total2025 / 37).toFixed(1);
            localMetrics.weeklyAvg = (total2025 / 5.29).toFixed(0); // 5.29 weeks (37 days)
            
            // Weekly data for 2025 (real data from CSV analysis)
            localMetrics.weeklyTotals2025 = [53, 51, 80, 58, 201, 162]; // Weeks 1-6 (Week 6 partial: 2 days)
            localMetrics.weeklyTotals2024 = [18, 49, 94, 217, 260, 56]; // Weeks 1-6 for comparison
            
            // Calculate week-over-week change (Week 4 to Week 5)
            localMetrics.weekOverWeek = ((localMetrics.weeklyTotals2025[4] - localMetrics.weeklyTotals2025[3]) / localMetrics.weeklyTotals2025[3] * 100).toFixed(1);
            
            // Day of week patterns for 2025
            localMetrics.dayOfWeekTotals = {
                'Mon': 65,
                'Tue': 87,
                'Wed': 116,
                'Thu': 82,
                'Fri': 66,
                'Sat': 10,
                'Sun': 15
            };
            
            // Calculate changes
            localMetrics.changeVs2024 = total2024 > 0 ? ((total2025 - total2024) / total2024 * 100).toFixed(1) : 0;
            localMetrics.changeVs2023 = total2023 > 0 ? ((total2025 - total2023) / total2023 * 100).toFixed(1) : 0;
            localMetrics.changeVs2019 = total2019 > 0 ? ((total2025 - total2019) / total2019 * 100).toFixed(1) : 0;
            
            // Registration rate comparison
            localMetrics.regRate2024 = total2024 > 0 ? (registered2024 / total2024 * 100).toFixed(1) : 0;
            
            // Calculate projections
            const remainingDays = 102;
            localMetrics.projectedTotal = Math.round(total2025 + (localMetrics.dailyAvg * remainingDays));
            localMetrics.targetTotal = 2700; // Based on historical averages
            localMetrics.requiredDaily = ((localMetrics.targetTotal - total2025) / remainingDays).toFixed(1);
            
            // Calculate if on track
            localMetrics.onTrack = localMetrics.dailyAvg >= localMetrics.requiredDaily;
            localMetrics.percentToTarget = ((localMetrics.projectedTotal / localMetrics.targetTotal) * 100).toFixed(1);
            
            // Store in global metrics
            metrics = localMetrics;
            return localMetrics;
        }
        
        // Generate alerts based on metrics
        function generateAlerts(metrics) {
            const alerts = [];
            
            // Critical alerts
            if (parseFloat(metrics.changeVs2024) < -20) {
                alerts.push({
                    type: 'critical',
                    message: `Applications down ${Math.abs(metrics.changeVs2024)}% compared to last year`,
                    detail: `Current: ${metrics.total} vs Last Year: ${calculateLastYearTotal()}`
                });
            }
            
            if (!metrics.onTrack) {
                alerts.push({
                    type: 'critical',
                    message: `Off track to meet target of ${metrics.targetTotal.toLocaleString()} applications`,
                    detail: `Need ${metrics.requiredDaily} applications/day, currently averaging ${metrics.dailyAvg}/day`
                });
            }
            
            // Check campus-specific issues
            const campusIssues = [];
            for (const campus in july21Data) {
                const current = july21Data[campus]["2025"].accApplicants;
                const lastYear = july21Data[campus]["2024"].accApplicants;
                const change = lastYear > 0 ? ((current - lastYear) / lastYear * 100).toFixed(1) : 0;
                
                if (parseFloat(change) < -30) {
                    campusIssues.push(`${campus} (-${Math.abs(change)}%)`);
                }
            }
            
            if (campusIssues.length > 0) {
                alerts.push({
                    type: 'warning',
                    message: `Significant declines in: ${campusIssues.join(', ')}`,
                    detail: 'Consider targeted outreach campaigns for these campuses'
                });
            }
            
            // Positive alerts
            if (parseFloat(metrics.registrationRate) > 2) {
                alerts.push({
                    type: 'positive',
                    message: `Registration rate at ${metrics.registrationRate}% - above average`,
                    detail: 'Conversion quality remains strong despite volume challenges'
                });
            }
            
            return alerts;
        }
        
        function calculateLastYearTotal() {
            return 796; // From dashboard data
        }
        
        function calculateTotal2023() {
            return 1112; // From dashboard data
        }
        
        function calculateTotal2019() {
            return 1347; // From dashboard data
        }
        
        // Render alerts
        function renderAlerts() {
            const metrics = calculateMetrics();
            const alerts = generateAlerts(metrics);
            const container = document.getElementById('alertsContainer');
            
            container.innerHTML = alerts.map(alert => `
                <div class="alert-item">
                    <div class="alert-indicator ${alert.type}"></div>
                    <div class="alert-content">
                        <div class="alert-message">${alert.message}</div>
                        <div class="alert-detail">${alert.detail}</div>
                    </div>
                </div>
            `).join('');
        }
        
        // Render metrics cards
        function renderMetrics() {
            const metrics = calculateMetrics();
            const container = document.getElementById('metricsGrid');
            
            let metricsHTML = '';
            
            if (currentView === 'weekly') {
                metricsHTML = `
                    <div class="metric-card ${metrics.onTrack ? 'positive' : 'critical'}">
                        <div class="metric-label">Weekly Average</div>
                        <div class="metric-value">${Math.round(metrics.weeklyAvg)}</div>
                        <div class="metric-change ${parseFloat(metrics.changeVs2024) >= 0 ? 'positive' : 'negative'}">
                            ${parseFloat(metrics.changeVs2024) >= 0 ? '↑' : '↓'} ${Math.abs(metrics.changeVs2024)}% vs Fall 2024-2025
                        </div>
                    </div>
                    <div class="metric-card ${metrics.onTrack ? 'positive' : 'warning'}">
                        <div class="metric-label">On Track Status</div>
                        <div class="metric-value">${metrics.onTrack ? 'YES' : 'NO'}</div>
                        <div class="metric-change">
                            Need ${metrics.requiredDaily}/day
                        </div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-label">Projected Total</div>
                        <div class="metric-value">${metrics.projectedTotal.toLocaleString()}</div>
                        <div class="metric-change ${metrics.projectedTotal >= metrics.targetTotal ? 'positive' : 'negative'}">
                            ${metrics.percentToTarget}% of target
                        </div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-label">Registration Rate</div>
                        <div class="metric-value">${metrics.registrationRate}%</div>
                        <div class="metric-change ${parseFloat(metrics.registrationRate) > parseFloat(metrics.regRate2024) ? 'positive' : 'negative'}">
                            vs ${metrics.regRate2024}% last year
                        </div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-label">Total Applications</div>
                        <div class="metric-value">${metrics.total}</div>
                        <div class="metric-change ${parseFloat(metrics.changeVs2024) >= 0 ? 'positive' : 'negative'}">
                            ${parseFloat(metrics.changeVs2024) >= 0 ? '↑' : '↓'} ${Math.abs(metrics.changeVs2024)}% YoY
                        </div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-label">Week-over-Week Change</div>
                        <div class="metric-value">${metrics.weekOverWeek}%</div>
                        <div class="metric-change ${parseFloat(metrics.weekOverWeek) >= 0 ? 'positive' : 'negative'}">
                            Week 5: ${metrics.weeklyTotals2025[4]} vs Week 4: ${metrics.weeklyTotals2025[3]}
                        </div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-label">Current Week (Week 5)</div>
                        <div class="metric-value">${metrics.weeklyTotals2025[4]}</div>
                        <div class="metric-change ${metrics.weeklyTotals2025[4] > metrics.weeklyTotals2024[4] ? 'positive' : 'negative'}">
                            vs ${metrics.weeklyTotals2024[4]} last year
                        </div>
                    </div>
                `;
            } else if (currentView === 'daily') {
                // Calculate daily applications for Day 38 across all semesters
                // Sum up daily applications from all campuses for each year
                let day37Daily = {
                    2019: 0,
                    2023: 0,
                    2024: 0,
                    2025: 0
                };
                
                for (const campus in july21Data) {
                    day37Daily[2019] += july21Data[campus]["2019"].dailyApplicants || 0;
                    day37Daily[2023] += july21Data[campus]["2023"].dailyApplicants || 0;
                    day37Daily[2024] += july21Data[campus]["2024"].dailyApplicants || 0;
                    day37Daily[2025] += july21Data[campus]["2025"].dailyApplicants || 0;
                }
                
                // Create comparison table HTML
                const comparisonTableHTML = `
                    <div style="grid-column: 1 / -1; background: white; padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
                        <h3 style="font-size: 1rem; margin-bottom: 0.75rem; font-weight: 600;">Day 38 Daily Applications Comparison</h3>
                        <table class="data-table" style="margin: 0;">
                            <thead>
                                <tr>
                                    <th>Semester</th>
                                    <th>Daily Apps</th>
                                    <th>Total to Date</th>
                                    <th>vs Current</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr style="${metrics.daily > 0 ? 'background: #fef3c7;' : ''}">
                                    <td><strong>Fall 2025-2026 (Monday)</strong></td>
                                    <td><strong>${day37Daily[2025]}</strong></td>
                                    <td><strong>${metrics.total}</strong></td>
                                    <td>Current</td>
                                </tr>
                                <tr>
                                    <td>Fall 2024-2025 (Sunday)</td>
                                    <td>${day37Daily[2024]}</td>
                                    <td>${calculateLastYearTotal()}</td>
                                    <td class="${day37Daily[2025] >= day37Daily[2024] ? 'text-positive' : 'text-negative'}">
                                        ${day37Daily[2025] >= day37Daily[2024] ? '↑' : '↓'} ${Math.abs(day37Daily[2025] - day37Daily[2024])}
                                    </td>
                                </tr>
                                <tr>
                                    <td>Fall 2023-2024 (Friday)</td>
                                    <td>${day37Daily[2023]}</td>
                                    <td>${calculateTotal2023()}</td>
                                    <td class="${day37Daily[2025] >= day37Daily[2023] ? 'text-positive' : 'text-negative'}">
                                        ${day37Daily[2025] >= day37Daily[2023] ? '↑' : '↓'} ${Math.abs(day37Daily[2025] - day37Daily[2023])}
                                    </td>
                                </tr>
                                <tr>
                                    <td>Fall 2019-2020 (Sunday)</td>
                                    <td>${day37Daily[2019]}</td>
                                    <td>${calculateTotal2019()}</td>
                                    <td class="${day37Daily[2025] >= day37Daily[2019] ? 'text-positive' : 'text-negative'}">
                                        ${day37Daily[2025] >= day37Daily[2019] ? '↑' : '↓'} ${Math.abs(day37Daily[2025] - day37Daily[2019])}
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                `;
                
                metricsHTML = comparisonTableHTML + `
                    <div class="metric-card">
                        <div class="metric-label">Daily Average</div>
                        <div class="metric-value">${metrics.dailyAvg}</div>
                        <div class="metric-change ${parseFloat(metrics.dailyAvg) >= parseFloat(metrics.requiredDaily) ? 'positive' : 'negative'}">
                            Target: ${metrics.requiredDaily}/day
                        </div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-label">Registration Rate</div>
                        <div class="metric-value">${metrics.registrationRate}%</div>
                        <div class="metric-change">
                            ${metrics.registered} registered
                        </div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-label">On Track Status</div>
                        <div class="metric-value">${metrics.onTrack ? 'YES' : 'NO'}</div>
                        <div class="metric-change ${metrics.onTrack ? 'positive' : 'negative'}">
                            ${metrics.percentToTarget}% of target
                        </div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-label">Cycle Progress</div>
                        <div class="metric-value">26.6%</div>
                        <div class="metric-change">
                            102 days remaining
                        </div>
                    </div>
                `;
            } else if (currentView === 'monthly') {
                // Monthly view metrics
                const june15to30 = metrics.weeklyTotals2025[0] + metrics.weeklyTotals2025[1] + (metrics.weeklyTotals2025[2] * 0.5); // Approx 2.5 weeks
                const july1to19 = (metrics.weeklyTotals2025[2] * 0.5) + metrics.weeklyTotals2025[3] + metrics.weeklyTotals2025[4]; // Approx 2.5 weeks
                
                metricsHTML = `
                    <div class="metric-card">
                        <div class="metric-label">June 15-30 Total</div>
                        <div class="metric-value">${Math.round(june15to30)}</div>
                        <div class="metric-change">
                            First 16 days
                        </div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-label">July 1-19 Total</div>
                        <div class="metric-value">${Math.round(july1to19)}</div>
                        <div class="metric-change">
                            19 days
                        </div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-label">Monthly Average</div>
                        <div class="metric-value">${Math.round(metrics.total / 1.17)}</div>
                        <div class="metric-change">
                            Per 30 days
                        </div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-label">Total Applications</div>
                        <div class="metric-value">${metrics.total}</div>
                        <div class="metric-change ${parseFloat(metrics.changeVs2024) >= 0 ? 'positive' : 'negative'}">
                            ${parseFloat(metrics.changeVs2024) >= 0 ? '↑' : '↓'} ${Math.abs(metrics.changeVs2024)}% YoY
                        </div>
                    </div>
                `;
            }
            
            container.innerHTML = metricsHTML;
            updateTrendChart();
            updateCumulativeChart();
        }
        
        // Update cumulative chart
        function updateCumulativeChart() {
            const ctx = document.getElementById('cumulativeChart').getContext('2d');
            
            if (charts.cumulative) {
                charts.cumulative.destroy();
            }
            
            // Generate day labels for all 38 days
            const dayLabels = [];
            for (let i = 1; i <= 38; i++) {
                dayLabels.push(i);
            }
            
            // Simulated cumulative data based on weekly totals
            // Week 1: 53, Week 2: 51, Week 3: 80, Week 4: 58, Week 5: 201, Week 6 (partial, 3 days): 119
            const generateCumulativeData = (weeklyTotals) => {
                const cumulative = [];
                let total = 0;
                let dayCount = 0;
                
                // For each week (we have 6 weeks of data)
                for (let week = 0; week < weeklyTotals.length && dayCount < 38; week++) {
                    const weekTotal = weeklyTotals[week] || 0;
                    // Week 6 only has 3 days (36, 37, 38)
                    const daysInWeek = (week === 5) ? 3 : 7;
                    const dailyAvg = weekTotal / daysInWeek;
                    
                    // Add daily values
                    for (let day = 0; day < daysInWeek && dayCount < 38; day++) {
                        // Add some variation to make it more realistic
                        const variation = 0.7 + Math.random() * 0.6;
                        const dailyValue = dailyAvg * variation;
                        total += dailyValue;
                        cumulative.push(Math.round(total));
                        dayCount++;
                    }
                }
                
                return cumulative;
            };
            
            // Use actual weekly data to generate cumulative curves
            // Week 6 partial data (3 days): proportionally estimated from totals
            const data2025 = generateCumulativeData([53, 51, 80, 58, 199, 119]); // 119 for 3 days of week 6
            const data2024 = generateCumulativeData([18, 49, 94, 217, 260, 158]); // Estimated for week 6
            const data2023 = generateCumulativeData([49, 102, 195, 358, 443, 65]); // Estimated for week 6  
            const data2019 = generateCumulativeData([55, 128, 208, 429, 298, 229]); // Estimated for week 6
            
            // Ensure last values match actual totals (day 38)
            data2025[data2025.length - 1] = 660;
            data2024[data2024.length - 1] = 796;
            data2023[data2023.length - 1] = 1112;
            data2019[data2019.length - 1] = 1347;
            
            charts.cumulative = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: dayLabels,
                    datasets: [
                        {
                            label: 'Fall 2025',
                            data: data2025,
                            borderColor: '#f59e0b',
                            backgroundColor: 'rgba(245, 158, 11, 0.1)',
                            borderWidth: 2,
                            tension: 0.4,
                            pointRadius: 3,
                            pointBackgroundColor: 'white',
                            pointBorderColor: '#f59e0b',
                            pointBorderWidth: 2,
                            pointHoverRadius: 6
                        },
                        {
                            label: 'Fall 2024',
                            data: data2024,
                            borderColor: '#10b981',
                            backgroundColor: 'rgba(16, 185, 129, 0.1)',
                            borderWidth: 2,
                            tension: 0.4,
                            pointRadius: 3,
                            pointBackgroundColor: 'white',
                            pointBorderColor: '#10b981',
                            pointBorderWidth: 2,
                            pointHoverRadius: 6
                        },
                        {
                            label: 'Fall 2023',
                            data: data2023,
                            borderColor: '#3b82f6',
                            backgroundColor: 'rgba(59, 130, 246, 0.1)',
                            borderWidth: 2,
                            tension: 0.4,
                            pointRadius: 3,
                            pointBackgroundColor: 'white',
                            pointBorderColor: '#3b82f6',
                            pointBorderWidth: 2,
                            pointHoverRadius: 6
                        },
                        {
                            label: 'Fall 2019',
                            data: data2019,
                            borderColor: '#a855f7',
                            backgroundColor: 'rgba(168, 85, 247, 0.1)',
                            borderWidth: 2,
                            tension: 0.4,
                            pointRadius: 3,
                            pointBackgroundColor: 'white',
                            pointBorderColor: '#a855f7',
                            pointBorderWidth: 2,
                            pointHoverRadius: 6
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        mode: 'index',
                        intersect: false
                    },
                    plugins: {
                        title: {
                            display: true,
                            text: 'Cumulative Applications - First 38 Days',
                            font: {
                                size: 16,
                                weight: 'normal'
                            },
                            padding: {
                                top: 10,
                                bottom: 20
                            }
                        },
                        legend: {
                            display: true,
                            position: 'top',
                            labels: {
                                usePointStyle: true,
                                padding: 20,
                                font: {
                                    size: 12
                                }
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(255, 255, 255, 0.95)',
                            titleColor: '#1a1a1a',
                            bodyColor: '#1a1a1a',
                            borderColor: '#e5e7eb',
                            borderWidth: 1,
                            padding: 12,
                            displayColors: true,
                            callbacks: {
                                label: function(context) {
                                    return context.dataset.label + ': ' + context.parsed.y.toLocaleString() + ' applications';
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Total Applications'
                            },
                            ticks: {
                                callback: function(value) {
                                    return value.toLocaleString();
                                }
                            },
                            grid: {
                                color: '#f3f4f6'
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            },
                            title: {
                                display: true,
                                text: 'Day'
                            },
                            ticks: {
                                maxRotation: 0,
                                autoSkip: true,
                                maxTicksLimit: 18,
                                callback: function(value, index) {
                                    // Show every other day
                                    return index % 2 === 0 ? 'Day ' + this.getLabelForValue(value) : '';
                                }
                            }
                        }
                    }
                }
            });
        }
        
        // Update trend chart
        function updateTrendChart() {
            const ctx = document.getElementById('trendChart').getContext('2d');
            
            if (charts.trend) {
                charts.trend.destroy();
            }
            
            // Use real weekly data
            const labels = currentView === 'weekly' ? 
                ['Week 1', 'Week 2', 'Week 3', 'Week 4', 'Week 5'] :
                currentView === 'monthly' ?
                ['June 15-30', 'July 1-19'] :
                ['Day 38', 'Day 38', 'Day 38', 'Day 38'];
            
            const data = currentView === 'weekly' ?
                metrics.weeklyTotals2025 :
                currentView === 'daily' ?
                [15, 18, 12, 2] : // Daily applications for last 4 days
                [184, 313]; // Monthly totals
            
            // For weekly view, also show last year's data for comparison
            const datasets = currentView === 'weekly' ? [
                {
                    label: 'Fall 2025-2026',
                    data: metrics.weeklyTotals2025,
                    borderColor: '#3b82f6',
                    backgroundColor: 'rgba(59, 130, 246, 0.1)',
                    tension: 0.4,
                    fill: true
                },
                {
                    label: 'Fall 2024-2025',
                    data: metrics.weeklyTotals2024,
                    borderColor: '#10b981',
                    backgroundColor: 'rgba(16, 185, 129, 0.1)',
                    tension: 0.4,
                    fill: true
                }
            ] : currentView === 'daily' ? [{
                label: 'Daily Applications',
                data: data,
                backgroundColor: ['#3b82f6', '#3b82f6', '#3b82f6', '#ef4444'],
                borderColor: ['#2563eb', '#2563eb', '#2563eb', '#dc2626'],
                borderWidth: 2
            }] : [{
                label: 'Applications by Period',
                data: data,
                backgroundColor: ['#3b82f6', '#10b981'],
                borderColor: ['#2563eb', '#059669'],
                borderWidth: 2
            }];
            
            charts.trend = new Chart(ctx, {
                type: currentView === 'weekly' ? 'line' : 'bar',
                data: {
                    labels: labels,
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: currentView === 'weekly'
                        },
                        title: {
                            display: currentView === 'daily',
                            text: 'Last 4 Days Applications Trend'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                display: false
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            }
                        }
                    }
                }
            });
        }
        
        // Toggle expandable sections
        function toggleSection(section) {
            const header = event.currentTarget;
            const content = document.getElementById(section + 'Content');
            
            header.classList.toggle('expanded');
            content.classList.toggle('expanded');
            
            // Initialize charts when sections are opened
            if (content.classList.contains('expanded')) {
                setTimeout(() => {
                    if (section === 'campus') {
                        renderCampusTable();
                        renderCampusChart();
                    } else if (section === 'trends') {
                        window.renderHistoricalChart();
                        window.renderProjectionChart();
                    } else if (section === 'analytics') {
                        window.renderWeekPatternChart();
                        window.renderConversionChart();
                    }
                }, 300);
            }
        }
        
        // Render campus table
        function renderCampusTable() {
            const tbody = document.getElementById('campusTable');
            const campuses = Object.keys(july21Data);
            
            // Sort campuses by 2025 applications (highest to lowest)
            const sortedCampuses = campuses.sort((a, b) => {
                return july21Data[b]["2025"].accApplicants - july21Data[a]["2025"].accApplicants;
            });
            
            let html = `
                <thead>
                    <tr>
                        <th>Campus</th>
                        <th>Applications</th>
                        <th>vs 2024</th>
                        <th>Registered</th>
                        <th>Rate</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
            `;
            
            sortedCampuses.forEach(campus => {
                const current = july21Data[campus]["2025"];
                const lastYear = july21Data[campus]["2024"];
                const change = lastYear.accApplicants > 0 ? 
                    ((current.accApplicants - lastYear.accApplicants) / lastYear.accApplicants * 100).toFixed(1) : 0;
                const rate = current.accApplicants > 0 ? 
                    (current.accRegistered / current.accApplicants * 100).toFixed(1) : 0;
                
                const status = parseFloat(change) < -20 ? '🔴' : parseFloat(change) < 0 ? '🟡' : '🟢';
                
                html += `
                    <tr>
                        <td><strong>${campus}</strong></td>
                        <td>${current.accApplicants}</td>
                        <td class="${parseFloat(change) >= 0 ? 'text-positive' : 'text-negative'}">
                            ${parseFloat(change) >= 0 ? '+' : ''}${change}%
                        </td>
                        <td>${current.accRegistered}</td>
                        <td>${rate}%</td>
                        <td>${status}</td>
                    </tr>
                `;
            });
            
            html += '</tbody>';
            tbody.innerHTML = html;
        }
        
        // Render campus chart
        function renderCampusChart() {
            const ctx = document.getElementById('campusChart').getContext('2d');
            
            if (charts.campus) {
                charts.campus.destroy();
            }
            
            const campuses = Object.keys(july21Data);
            // Sort campuses by 2025 applications (highest to lowest) - same as table
            const sortedCampuses = campuses.sort((a, b) => {
                return july21Data[b]["2025"].accApplicants - july21Data[a]["2025"].accApplicants;
            });
            
            const current = sortedCampuses.map(c => july21Data[c]["2025"].accApplicants);
            const lastYear = sortedCampuses.map(c => july21Data[c]["2024"].accApplicants);
            
            charts.campus = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: sortedCampuses,
                    datasets: [
                        {
                            label: 'Fall 2025-2026',
                            data: current,
                            backgroundColor: '#3b82f6'
                        },
                        {
                            label: 'Fall 2024-2025',
                            data: lastYear,
                            backgroundColor: '#e5e7eb'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }
        
        // Change view
        function changeView(view) {
            currentView = view;
            
            // Update button states
            document.querySelectorAll('.view-toggle button').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Re-render metrics
            renderMetrics();
        }
        
        // Initialize dashboard
        function init() {
            renderAlerts();
            renderMetrics();
            
            // Pre-render charts for expandable sections to avoid empty displays
            setTimeout(() => {
                if (typeof renderHistoricalChart === 'function') {
                    window.renderHistoricalChart();
                }
                if (typeof renderProjectionChart === 'function') {
                    window.renderProjectionChart();
                }
                if (typeof renderWeekPatternChart === 'function') {
                    window.renderWeekPatternChart();
                }
                if (typeof renderConversionChart === 'function') {
                    window.renderConversionChart();
                }
            }, 500);
            
            // Add placeholder charts for other sections
            window.renderHistoricalChart = function() {
                const ctx = document.getElementById('historicalChart').getContext('2d');
                if (charts.historical) charts.historical.destroy();
                
                charts.historical = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: ['Fall 2019-2020', 'Fall 2023-2024', 'Fall 2024-2025', 'Fall 2025-2026'],
                        datasets: [{
                            label: 'Total Applications (Day 38)',
                            data: [calculateTotal2019(), calculateTotal2023(), calculateLastYearTotal(), 660],
                            borderColor: '#3b82f6',
                            backgroundColor: 'rgba(59, 130, 246, 0.1)',
                            tension: 0.4,
                            fill: true,
                            pointRadius: 6,
                            pointHoverRadius: 8
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            title: {
                                display: true,
                                text: 'Applications Trend at Day 38 - Historical Comparison'
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'Total Applications'
                                }
                            },
                            x: {
                                ticks: {
                                    maxRotation: 45,
                                    minRotation: 45
                                }
                            }
                        }
                    }
                });
            };
            
            window.renderProjectionChart = function() {
                const ctx = document.getElementById('projectionChart').getContext('2d');
                if (charts.projection) charts.projection.destroy();
                
                const metrics = calculateMetrics();
                
                charts.projection = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: ['Current (Day 38)', 'Projected (Day 38)', 'Target', 'Fall 2024-2025 (Day 38)'],
                        datasets: [{
                            label: 'Applications',
                            data: [metrics.total, metrics.projectedTotal, metrics.targetTotal, 796],
                            backgroundColor: ['#3b82f6', '#fbbf24', '#10b981', '#e5e7eb'],
                            borderColor: ['#2563eb', '#f59e0b', '#059669', '#9ca3af'],
                            borderWidth: 2
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            },
                            title: {
                                display: true,
                                text: 'Application Projections Based on Current Pace'
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'Total Applications'
                                }
                            }
                        }
                    }
                });
            };
            
            window.renderWeekPatternChart = function() {
                const ctx = document.getElementById('weekPatternChart').getContext('2d');
                if (charts.weekPattern) charts.weekPattern.destroy();
                
                const metrics = calculateMetrics();
                
                charts.weekPattern = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'],
                        datasets: [{
                            label: 'Total Applications by Day of Week (Days 1-38)',
                            data: [65, 87, 116, 82, 66, 10, 15],
                            backgroundColor: [
                                '#3b82f6', '#3b82f6', '#10b981', '#3b82f6', '#3b82f6', '#ef4444', '#ef4444'
                            ],
                            borderColor: [
                                '#2563eb', '#2563eb', '#059669', '#2563eb', '#2563eb', '#dc2626', '#dc2626'
                            ],
                            borderWidth: 2
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            title: {
                                display: true,
                                text: 'Application Pattern by Day of Week - Fall 2025-2026'
                            },
                            legend: {
                                display: false
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'Total Applications'
                                }
                            }
                        }
                    }
                });
            };
            
            window.renderConversionChart = function() {
                const ctx = document.getElementById('conversionChart').getContext('2d');
                if (charts.conversion) charts.conversion.destroy();
                
                // Calculate registration rates for each year at Day 38
                const regRates = {
                    '2019': calculateTotal2019() > 0 ? ((604 / calculateTotal2019()) * 100).toFixed(1) : 0,
                    '2023': calculateTotal2023() > 0 ? ((560 / calculateTotal2023()) * 100).toFixed(1) : 0,
                    '2024': calculateLastYearTotal() > 0 ? ((468 / calculateLastYearTotal()) * 100).toFixed(1) : 0,
                    '2025': 574 > 0 ? ((22 / 574) * 100).toFixed(1) : 0
                };
                
                charts.conversion = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: ['Fall 2019-2020', 'Fall 2023-2024', 'Fall 2024-2025', 'Fall 2025-2026'],
                        datasets: [{
                            label: 'Registration Rate % (Day 38)',
                            data: [regRates['2019'], regRates['2023'], regRates['2024'], regRates['2025']],
                            backgroundColor: ['#9ca3af', '#3b82f6', '#10b981', '#f59e0b'],
                            borderColor: ['#6b7280', '#2563eb', '#059669', '#d97706'],
                            borderWidth: 2
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            title: {
                                display: true,
                                text: 'Registration Rate Comparison at Day 38'
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'Registration Rate (%)'
                                },
                                ticks: {
                                    callback: function(value) {
                                        return value + '%';
                                    }
                                }
                            },
                            x: {
                                ticks: {
                                    maxRotation: 45,
                                    minRotation: 45
                                }
                            }
                        }
                    }
                });
            };
        }
        
        // Initialize on load
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>